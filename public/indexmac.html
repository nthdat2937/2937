<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ntdWeb</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            user-select: none;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'Segoe UI', Roboto, sans-serif;
            overflow: hidden;
            height: 100vh;
            background: #000;
        }

        .desktop {
            width: 100%;
            height: 100%;
            background: url('https://4kwallpapers.com/images/wallpapers/macos-sonoma-2880x1800-12419.jpg') center/cover;
            position: relative;
        }

        /* Menu Bar */
        .menu-bar {
            height: 28px;
            background: rgba(30, 30, 30, 0.7);
            backdrop-filter: blur(30px);
            -webkit-backdrop-filter: blur(30px);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 10px;
            color: white;
            font-size: 13px;
            font-weight: 500;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 9999;
        }

        .menu-left {
            display: flex;
            align-items: center;
            gap: 18px;
        }

        .menu-left .apple-logo {
            font-size: 16px;
            cursor: pointer;
            padding: 2px 8px;
            border-radius: 4px;
        }

        .menu-left span,
        .menu-right span {
            cursor: pointer;
            padding: 2px 8px;
            border-radius: 4px;
            transition: background 0.2s;
        }

        .menu-left span:hover,
        .menu-right span:hover,
        .menu-left .apple-logo:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .menu-right {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .menu-right i {
            padding: 2px 6px;
            cursor: pointer;
        }

        /* Desktop Icons */
        .desktop-icons {
            position: absolute;
            top: 40px;
            right: 20px;
            display: grid;
            grid-template-columns: repeat(auto-fill, 90px);
            grid-auto-rows: 100px;
            gap: 5px;
            max-height: calc(100vh - 120px);
            width: auto;
            max-width: 400px;
            direction: rtl;
        }

        .desktop-icon {
            direction: ltr;
            width: 85px;
            display: flex;
            flex-direction: column;
            align-items: center;
            cursor: pointer;
            padding: 8px 5px;
            border-radius: 8px;
            transition: background 0.2s;
        }

        .desktop-icon:hover {
            background: rgba(255, 255, 255, 0.15);
        }

        .desktop-icon.selected {
            background: rgba(0, 122, 255, 0.5);
        }

        .desktop-icon img {
            width: 55px;
            height: 55px;
            object-fit: contain;
            filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.3));
        }

        .desktop-icon span {
            color: white;
            font-size: 11px;
            text-align: center;
            margin-top: 5px;
            text-shadow: 0 1px 3px rgba(0, 0, 0, 0.8);
            word-wrap: break-word;
            max-width: 80px;
            line-height: 1.2;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        /* Dock */
        .dock-container {
            position: fixed;
            bottom: 5px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 1000;
        }

        .dock {
            display: flex;
            align-items: flex-end;
            gap: 4px;
            padding: 4px 8px;
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(30px);
            -webkit-backdrop-filter: blur(30px);
            border-radius: 18px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
        }

        .dock-separator {
            width: 1px;
            height: 45px;
            background: rgba(255, 255, 255, 0.3);
            margin: 0 4px;
            align-self: center;
        }

        .dock-item {
            position: relative;
            cursor: pointer;
            transition: all 0.2s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .dock-item img {
            width: 48px;
            height: 48px;
            object-fit: contain;
            border-radius: 10px;
            transition: all 0.2s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            filter: drop-shadow(0 3px 8px rgba(0, 0, 0, 0.3));
        }

        .dock-item:hover img {
            transform: translateY(-10px) scale(1.3);
        }

        .dock-item .tooltip {
            position: absolute;
            bottom: 70px;
            left: 50%;
            transform: translateX(-50%) scale(0);
            background: rgba(30, 30, 30, 0.95);
            color: white;
            padding: 6px 12px;
            border-radius: 5px;
            font-size: 12px;
            white-space: nowrap;
            opacity: 0;
            transition: all 0.2s;
            pointer-events: none;
            z-index: 1001;
        }

        .dock-item:hover .tooltip {
            transform: translateX(-50%) scale(1);
            opacity: 1;
        }

        /* Dock indicator dot - FIXED */
        .dock-item .dock-indicator {
            width: 4px;
            height: 4px;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 50%;
            margin-top: 2px;
            opacity: 0;
            transition: opacity 0.2s;
        }

        .dock-item.running .dock-indicator {
            opacity: 1;
        }

        /* Window */
        .window {
            position: absolute;
            background: rgba(30, 30, 30, 0.95);
            backdrop-filter: blur(30px);
            -webkit-backdrop-filter: blur(30px);
            border-radius: 12px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            min-width: 300px;
            min-height: 200px;
            overflow: hidden;
            z-index: 100;
            display: none;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: transform 0.3s, opacity 0.3s;
        }

        .window.active {
            z-index: 999;
        }

        .window.minimized {
            transform: scale(0.1) translateY(100vh);
            opacity: 0;
            pointer-events: none;
        }

        .window-header {
            height: 38px;
            background: rgba(60, 60, 60, 0.9);
            display: flex;
            align-items: center;
            padding: 0 12px;
            cursor: move;
            border-bottom: 1px solid rgba(0, 0, 0, 0.3);
        }

        .window-controls {
            display: flex;
            gap: 8px;
        }

        .window-btn {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            cursor: pointer;
            border: none;
            transition: all 0.2s;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 9px;
            color: transparent;
            font-weight: bold;
        }

        .window-btn.close {
            background: #ff5f56;
        }

        .window-btn.minimize {
            background: #ffbd2e;
        }

        .window-btn.maximize {
            background: #27ca40;
        }

        .window-controls:hover .window-btn {
            color: rgba(0, 0, 0, 0.6);
        }

        .window-title {
            flex: 1;
            text-align: center;
            color: white;
            font-size: 13px;
            font-weight: 500;
            margin-right: 60px;
        }

        .window-content {
            height: calc(100% - 38px);
            overflow: auto;
            color: white;
        }

        .window-content::-webkit-scrollbar {
            width: 8px;
        }

        .window-content::-webkit-scrollbar-track {
            background: transparent;
        }

        .window-content::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.3);
            border-radius: 4px;
        }

        /* Launchpad */
        .launchpad {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(30px);
            -webkit-backdrop-filter: blur(30px);
            z-index: 2000;
            display: none;
            flex-direction: column;
            padding: 60px 50px 100px;
            opacity: 0;
            transform: scale(1.2);
            transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }

        .launchpad.show {
            display: flex;
            opacity: 1;
            transform: scale(1);
        }

        .launchpad-search {
            display: flex;
            justify-content: center;
            margin-bottom: 30px;
        }

        .launchpad-search input {
            width: 250px;
            padding: 10px 20px;
            background: rgba(255, 255, 255, 0.15);
            border: none;
            border-radius: 8px;
            color: white;
            font-size: 14px;
            outline: none;
        }

        .launchpad-search input::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }

        .launchpad-apps {
            flex: 1;
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 30px;
            overflow-y: auto;
            padding: 20px;
            justify-items: center;
            align-content: start;
        }

        .launchpad-app {
            display: flex;
            flex-direction: column;
            align-items: center;
            cursor: pointer;
            padding: 10px;
            border-radius: 10px;
            transition: all 0.2s;
        }

        .launchpad-app:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: scale(1.05);
        }

        .launchpad-app img {
            width: 70px;
            height: 70px;
            object-fit: contain;
            border-radius: 15px;
            filter: drop-shadow(0 5px 15px rgba(0, 0, 0, 0.4));
        }

        .launchpad-app span {
            color: white;
            font-size: 12px;
            margin-top: 8px;
            text-align: center;
            max-width: 90px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        /* Context Menu */
        .context-menu {
            position: fixed;
            background: rgba(40, 40, 40, 0.95);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-radius: 8px;
            padding: 5px 0;
            min-width: 200px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.4);
            z-index: 10000;
            display: none;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .context-menu-item {
            padding: 8px 20px;
            color: white;
            font-size: 13px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: background 0.1s;
        }

        .context-menu-item:hover {
            background: #0066cc;
        }

        .context-menu-separator {
            height: 1px;
            background: rgba(255, 255, 255, 0.1);
            margin: 5px 0;
        }

        /* Modal */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(10px);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 5000;
        }

        .modal.show {
            display: flex;
        }

        .modal-content {
            background: rgba(40, 40, 40, 0.95);
            backdrop-filter: blur(30px);
            border-radius: 15px;
            padding: 30px;
            width: 450px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }

        .modal-header h2 {
            color: white;
            font-size: 20px;
            font-weight: 600;
        }

        .modal-close {
            background: none;
            border: none;
            color: rgba(255, 255, 255, 0.5);
            font-size: 24px;
            cursor: pointer;
        }

        .modal-close:hover {
            color: white;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            color: rgba(255, 255, 255, 0.7);
            font-size: 13px;
            margin-bottom: 8px;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 12px 15px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            color: white;
            font-size: 14px;
            outline: none;
        }

        .form-group input:focus,
        .form-group select:focus {
            border-color: #0066cc;
        }

        .form-group select option {
            background: #333;
        }

        .form-actions {
            display: flex;
            gap: 12px;
            justify-content: flex-end;
            margin-top: 25px;
        }

        .btn {
            padding: 10px 25px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            border: none;
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            color: white;
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .btn-primary {
            background: #0066cc;
            color: white;
        }

        .btn-primary:hover {
            background: #0055aa;
        }

        /* Spotlight */
        .spotlight {
            position: fixed;
            top: 20%;
            left: 50%;
            transform: translateX(-50%) scale(0.9);
            width: 600px;
            background: rgba(40, 40, 40, 0.95);
            backdrop-filter: blur(30px);
            border-radius: 15px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            z-index: 3000;
            display: none;
            opacity: 0;
            transition: all 0.2s;
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .spotlight.show {
            display: block;
            opacity: 1;
            transform: translateX(-50%) scale(1);
        }

        .spotlight-input {
            width: 100%;
            padding: 20px 25px;
            background: transparent;
            border: none;
            color: white;
            font-size: 22px;
            outline: none;
        }

        .spotlight-input::placeholder {
            color: rgba(255, 255, 255, 0.4);
        }

        .spotlight-results {
            max-height: 400px;
            overflow-y: auto;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .spotlight-result {
            padding: 12px 25px;
            display: flex;
            align-items: center;
            gap: 15px;
            cursor: pointer;
        }

        .spotlight-result:hover {
            background: #0066cc;
        }

        .spotlight-result img {
            width: 40px;
            height: 40px;
            object-fit: contain;
            border-radius: 8px;
        }

        .spotlight-result-name {
            color: white;
            font-size: 14px;
        }

        .spotlight-result-type {
            color: rgba(255, 255, 255, 0.5);
            font-size: 12px;
        }

        /* Notification Center */
        .notification-center {
            position: fixed;
            top: 28px;
            right: 0;
            width: 350px;
            height: calc(100% - 28px);
            background: rgba(30, 30, 30, 0.9);
            backdrop-filter: blur(30px);
            z-index: 1500;
            transform: translateX(100%);
            transition: transform 0.3s;
            padding: 20px;
            overflow-y: auto;
            border-left: 1px solid rgba(255, 255, 255, 0.1);
        }

        .notification-center.show {
            transform: translateX(0);
        }

        .notification-header {
            color: white;
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 20px;
        }

        .widget {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 15px;
            margin-bottom: 15px;
        }

        .widget-title {
            color: rgba(255, 255, 255, 0.6);
            font-size: 12px;
            text-transform: uppercase;
            margin-bottom: 10px;
        }

        .calendar-widget .date {
            color: white;
            font-size: 48px;
            font-weight: 200;
        }

        .calendar-widget .day {
            color: rgba(255, 255, 255, 0.7);
            font-size: 16px;
        }

        .weather-widget .temp {
            color: white;
            font-size: 42px;
            font-weight: 200;
        }

        .weather-widget .condition {
            color: rgba(255, 255, 255, 0.7);
            font-size: 14px;
        }

        /* Finder Content */
        .finder-content {
            display: flex;
            height: 100%;
        }

        .finder-sidebar {
            width: 180px;
            background: rgba(0, 0, 0, 0.3);
            padding: 15px 10px;
            border-right: 1px solid rgba(255, 255, 255, 0.1);
        }

        .finder-sidebar-title {
            color: rgba(255, 255, 255, 0.5);
            font-size: 11px;
            text-transform: uppercase;
            margin-bottom: 8px;
            padding: 0 10px;
        }

        .finder-sidebar-item {
            padding: 6px 10px;
            color: white;
            font-size: 13px;
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .finder-sidebar-item:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .finder-sidebar-item.active {
            background: rgba(0, 122, 255, 0.5);
        }

        .finder-main {
            flex: 1;
            padding: 15px;
        }

        .finder-files {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(90px, 1fr));
            gap: 15px;
        }

        .finder-file {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 10px;
            border-radius: 8px;
            cursor: pointer;
        }

        .finder-file:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .finder-file i {
            font-size: 42px;
            margin-bottom: 8px;
        }

        .finder-file span {
            color: white;
            font-size: 11px;
            text-align: center;
        }

        /* Settings */
        .settings-content {
            display: flex;
            height: 100%;
        }

        .settings-sidebar {
            width: 220px;
            background: rgba(0, 0, 0, 0.3);
            padding: 15px 10px;
            border-right: 1px solid rgba(255, 255, 255, 0.1);
            overflow-y: auto;
        }

        .settings-item {
            padding: 10px 15px;
            color: white;
            font-size: 13px;
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 2px;
        }

        .settings-item:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .settings-item.active {
            background: rgba(0, 122, 255, 0.5);
        }

        .settings-item i {
            width: 26px;
            height: 26px;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 13px;
        }

        .settings-main {
            flex: 1;
            padding: 25px;
        }

        .settings-main h3 {
            color: white;
            font-size: 24px;
            font-weight: 600;
            margin-bottom: 25px;
        }

        .setting-option {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .setting-option-title {
            color: white;
            font-size: 14px;
            margin-bottom: 4px;
        }

        .setting-option-desc {
            color: rgba(255, 255, 255, 0.5);
            font-size: 12px;
        }

        .toggle {
            width: 44px;
            height: 24px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            position: relative;
            cursor: pointer;
            transition: background 0.3s;
        }

        .toggle.active {
            background: #34c759;
        }

        .toggle::after {
            content: '';
            position: absolute;
            width: 20px;
            height: 20px;
            background: white;
            border-radius: 50%;
            top: 2px;
            left: 2px;
            transition: transform 0.3s;
        }

        .toggle.active::after {
            transform: translateX(20px);
        }

        /* Apple Menu */
        .apple-menu-dropdown {
            position: fixed;
            top: 28px;
            left: 10px;
            background: rgba(40, 40, 40, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 8px;
            padding: 5px 0;
            min-width: 230px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.4);
            z-index: 10000;
            display: none;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .apple-menu-dropdown.show {
            display: block;
        }

        /* Boot Screen */
        .boot-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #000;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 99999;
            transition: opacity 0.5s;
        }

        .boot-screen.hide {
            opacity: 0;
            pointer-events: none;
        }

        .apple-boot-logo {
            font-size: 80px;
            color: white;
            margin-bottom: 30px;
        }

        .boot-progress {
            width: 200px;
            height: 4px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 2px;
            overflow: hidden;
        }

        .boot-progress-bar {
            width: 0%;
            height: 100%;
            background: white;
            transition: width 0.3s;
        }

        @keyframes bounce {

            0%,
            100% {
                transform: translateY(0);
            }

            50% {
                transform: translateY(-15px);
            }
        }

        .dock-item.bouncing img {
            animation: bounce 0.5s ease-in-out 3;
        }

        .resize-handle {
            position: absolute;
            bottom: 0;
            right: 0;
            width: 15px;
            height: 15px;
            cursor: nwse-resize;
        }

        /* Terminal */
        .terminal-content {
            padding: 10px 15px;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 13px;
            color: #33ff00;
            background: #1a1a1a;
            height: 100%;
            overflow-y: auto;
        }

        .terminal-line {
            margin-bottom: 3px;
            white-space: pre-wrap;
        }

        .terminal-input-line {
            display: flex;
            align-items: center;
        }

        .terminal-prompt {
            color: #0a84ff;
            margin-right: 8px;
        }

        .terminal-input-line input {
            flex: 1;
            background: transparent;
            border: none;
            color: #33ff00;
            font-family: inherit;
            font-size: inherit;
            outline: none;
        }

        /* Notes */
        .notes-content {
            display: flex;
            height: 100%;
        }

        .notes-sidebar {
            width: 200px;
            background: rgba(0, 0, 0, 0.3);
            border-right: 1px solid rgba(255, 255, 255, 0.1);
            overflow-y: auto;
        }

        .notes-list-item {
            padding: 12px 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            cursor: pointer;
        }

        .notes-list-item:hover,
        .notes-list-item.active {
            background: rgba(255, 255, 255, 0.1);
        }

        .notes-list-title {
            color: white;
            font-size: 13px;
            font-weight: 500;
            margin-bottom: 4px;
        }

        .notes-list-preview {
            color: rgba(255, 255, 255, 0.5);
            font-size: 11px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .notes-editor {
            flex: 1;
            padding: 20px;
        }

        .notes-editor textarea {
            width: 100%;
            height: 100%;
            background: transparent;
            border: none;
            color: white;
            font-size: 14px;
            resize: none;
            outline: none;
            line-height: 1.6;
        }

        /* Safari */
        .safari-toolbar {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 12px;
            background: rgba(50, 50, 50, 0.95);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .safari-toolbar button {
            background: none;
            border: none;
            color: rgba(255, 255, 255, 0.6);
            font-size: 14px;
            cursor: pointer;
            padding: 5px 8px;
            border-radius: 4px;
        }

        .safari-toolbar button:hover {
            color: white;
            background: rgba(255, 255, 255, 0.1);
        }

        .safari-url {
            flex: 1;
            padding: 8px 15px;
            background: rgba(255, 255, 255, 0.1);
            border: none;
            border-radius: 8px;
            color: white;
            font-size: 13px;
            outline: none;
        }

        .safari-content iframe {
            width: 100%;
            height: calc(100% - 50px);
            border: none;
        }

        /* Calculator */
        .calculator-content {
            padding: 12px;
            background: #000;
            height: 100%;
            display: flex;
            flex-direction: column;
        }

        .calc-display {
            background: #000;
            padding: 10px 15px;
            text-align: right;
            font-size: 55px;
            font-weight: 300;
            color: white;
            min-height: 80px;
            display: flex;
            align-items: flex-end;
            justify-content: flex-end;
            margin-bottom: 10px;
        }

        .calc-buttons {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            flex: 1;
        }

        .calc-btn {
            border: none;
            border-radius: 50%;
            font-size: 28px;
            font-weight: 400;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            aspect-ratio: 1;
        }

        .calc-btn:active {
            opacity: 0.7;
        }

        .calc-btn.gray {
            background: #a5a5a5;
            color: black;
        }

        .calc-btn.dark {
            background: #333333;
            color: white;
        }

        .calc-btn.orange {
            background: #ff9f0a;
            color: white;
        }

        .calc-btn.orange.active-op {
            background: white;
            color: #ff9f0a;
        }

        .calc-btn.zero {
            grid-column: span 2;
            border-radius: 50px;
            aspect-ratio: auto;
            justify-content: flex-start;
            padding-left: 28px;
        }

        /* About */
        .about-mac {
            padding: 30px;
            text-align: center;
        }

        .about-mac img {
            width: 180px;
            margin-bottom: 20px;
        }

        .about-mac h2 {
            font-size: 22px;
            margin-bottom: 5px;
        }

        .about-mac p {
            color: rgba(255, 255, 255, 0.6);
            margin-bottom: 5px;
            font-size: 13px;
        }

        .app-default {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            color: rgba(255, 255, 255, 0.5);
            padding: 40px;
        }

        .app-default img {
            width: 100px;
            height: 100px;
            margin-bottom: 20px;
            opacity: 0.6;
        }

        .app-default h3 {
            font-size: 20px;
            margin-bottom: 10px;
            color: rgba(255, 255, 255, 0.8);
        }
    </style>
</head>

<body>
    <div class="boot-screen" id="bootScreen">
        <i class="fab fa-apple apple-boot-logo"></i>
        <div class="boot-progress">
            <div class="boot-progress-bar" id="bootProgress"></div>
        </div>
    </div>

    <div class="desktop" id="desktop">
        <div class="menu-bar">
            <div class="menu-left">
                <span class="apple-logo" id="appleMenuBtn"><i class="fab fa-apple"></i></span>
                <span id="activeAppName"><strong>Finder</strong></span>
                <span>File</span>
                <span>Edit</span>
                <span>View</span>
                <span>Go</span>
                <span>Window</span>
                <span>Help</span>
            </div>
            <div class="menu-right">
                <i class="fas fa-wifi"></i>
                <i class="fas fa-bluetooth-b"></i>
                <i class="fas fa-battery-full"></i>
                <span id="currentTime"></span>
                <span id="notificationBtn"><i class="fas fa-list"></i></span>
            </div>
        </div>

        <div class="apple-menu-dropdown" id="appleMenu">
            <div class="context-menu-item" id="aboutMacBtn"><strong>About This Mac</strong></div>
            <div class="context-menu-separator"></div>
            <div class="context-menu-item" id="openSettingsBtn">System Preferences...</div>
            <div class="context-menu-item">App Store...</div>
            <div class="context-menu-separator"></div>
            <div class="context-menu-item">Force Quit...</div>
            <div class="context-menu-separator"></div>
            <div class="context-menu-item">Sleep</div>
            <div class="context-menu-item" id="restartBtn">Restart...</div>
            <div class="context-menu-item">Shut Down...</div>
            <div class="context-menu-separator"></div>
            <div class="context-menu-item">Lock Screen</div>
        </div>

        <div class="desktop-icons" id="desktopIcons"></div>

        <div class="dock-container">
            <div class="dock" id="dock"></div>
        </div>

        <div class="launchpad" id="launchpad">
            <div class="launchpad-search">
                <input type="text" placeholder="Search" id="launchpadSearch">
            </div>
            <div class="launchpad-apps" id="launchpadApps"></div>
        </div>

        <div class="spotlight" id="spotlight">
            <input type="text" class="spotlight-input" placeholder="Spotlight Search" id="spotlightInput">
            <div class="spotlight-results" id="spotlightResults"></div>
        </div>

        <div class="notification-center" id="notificationCenter">
            <div class="notification-header">Notification Center</div>
            <div class="widget calendar-widget">
                <div class="widget-title">Calendar</div>
                <div class="date" id="calendarDate"></div>
                <div class="day" id="calendarDay"></div>
            </div>
            <div class="widget weather-widget">
                <div class="widget-title">Weather</div>
                <div class="temp">‚òÄÔ∏è 25¬∞C</div>
                <div class="condition">Sunny</div>
            </div>
        </div>

        <div class="context-menu" id="contextMenu">
            <div class="context-menu-item" id="ctxNewFolder"><i class="fas fa-folder-plus"></i> New Folder</div>
            <div class="context-menu-separator"></div>
            <div class="context-menu-item" id="ctxAddApp"><i class="fas fa-plus"></i> Add New App</div>
            <div class="context-menu-item" id="ctxAddToDock"><i class="fas fa-plus-circle"></i> Add to Dock</div>
            <div class="context-menu-item" id="ctxRemoveFromDock"><i class="fas fa-minus-circle"></i> Remove from Dock
            </div>
            <div class="context-menu-item" id="ctxRemoveApp"><i class="fas fa-trash"></i> Delete App</div>
            <div class="context-menu-separator"></div>
            <div class="context-menu-item" id="ctxChangeWallpaper"><i class="fas fa-image"></i> Change Wallpaper</div>
        </div>

        <div class="modal" id="addAppModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>‚ûï Add New App</h2>
                    <button class="modal-close" id="closeModal">&times;</button>
                </div>
                <div class="form-group">
                    <label>App Name *</label>
                    <input type="text" id="appName" placeholder="My App">
                </div>
                <div class="form-group">
                    <label>Icon URL *</label>
                    <input type="text" id="appIcon" placeholder="https://example.com/icon.png">
                </div>
                <div class="form-group">
                    <label>URL / Page (optional)</label>
                    <input type="text" id="appUrl" placeholder="https://example.com">
                </div>
                <div class="form-group">
                    <label>Add to</label>
                    <select id="appLocation">
                        <option value="desktop">Desktop Only</option>
                        <option value="dock">Dock Only</option>
                        <option value="both">Desktop + Dock</option>
                        <option value="launchpad">Launchpad Only</option>
                    </select>
                </div>
                <div class="form-actions">
                    <button class="btn btn-secondary" id="cancelAddApp">Cancel</button>
                    <button class="btn btn-primary" id="confirmAddApp">Add App</button>
                </div>
            </div>
        </div>

        <div class="modal" id="wallpaperModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>üñºÔ∏è Change Wallpaper</h2>
                    <button class="modal-close" id="closeWallpaperModal">&times;</button>
                </div>
                <div class="form-group">
                    <label>Wallpaper URL</label>
                    <input type="text" id="wallpaperUrl" placeholder="https://example.com/wallpaper.jpg">
                </div>
                <div class="form-actions">
                    <button class="btn btn-secondary" id="cancelWallpaper">Cancel</button>
                    <button class="btn btn-primary" id="confirmWallpaper">Apply</button>
                </div>
            </div>
        </div>

        <div id="windowsContainer"></div>
    </div>

    <script>
        // ==================== APP DATA ====================
        let apps = [ // id, name, icon, dock, desktop, system, url
            { id: 'finder', name: 'Finder', icon: 'https://upload.wikimedia.org/wikipedia/commons/7/71/Finder_icon_macOS_Yosemite.png', dock: true, desktop: false, system: true },
            { id: 'launchpad', name: 'Launchpad', icon: 'https://upload.wikimedia.org/wikipedia/it/5/57/Icona_Launchpad.png', dock: true, desktop: false, system: true },
            { id: 'safari', name: 'Safari', icon: 'https://images.icon-icons.com/3053/PNG/512/safari_macos_bigsur_icon_189770.png', dock: true, desktop: false, url: 'https://www.google.com' },
            { id: 'messages', name: 'Messages', icon: 'https://cdn-icons-png.freepik.com/512/16566/16566057.png', dock: true, desktop: false },
            { id: 'mail', name: 'Mail', icon: 'https://upload.wikimedia.org/wikipedia/commons/thumb/4/4e/Mail_%28iOS%29.svg/500px-Mail_%28iOS%29.svg.png', dock: true, desktop: false },
            { id: 'photos', name: 'Photos', icon: 'https://cdn.iconscout.com/icon/free/png-256/free-apple-photos-icon-svg-download-png-493155.png', dock: true, desktop: false },
            { id: 'notes', name: 'Notes', icon: 'https://cdn.iconscout.com/icon/free/png-256/free-apple-notes-icon-svg-download-png-493153.png', dock: true, desktop: false },
            { id: 'music', name: 'Music', icon: 'https://upload.wikimedia.org/wikipedia/commons/thumb/5/5f/Apple_Music_icon.svg/500px-Apple_Music_icon.svg.png', dock: true, desktop: false },
            { id: 'settings', name: 'System Preferences', icon: 'https://cdn.jim-nielsen.com/macos/512/system-preferences-2021-06-03.png?rf=1024', dock: true, desktop: false },
            { id: 'chrome', name: 'Google Chrome', icon: 'https://upload.wikimedia.org/wikipedia/commons/thumb/e/e1/Google_Chrome_icon_%28February_2022%29.svg/480px-Google_Chrome_icon_%28February_2022%29.svg.png', dock: false, desktop: true, url: 'https://www.google.com' },
            { id: 'vscode', name: 'VS Code', icon: 'https://upload.wikimedia.org/wikipedia/commons/thumb/9/9a/Visual_Studio_Code_1.35_icon.svg/512px-Visual_Studio_Code_1.35_icon.svg.png', dock: false, desktop: true, url: 'https://vscode.dev' },
            { id: 'spotify', name: 'Spotify', icon: 'https://upload.wikimedia.org/wikipedia/commons/thumb/8/84/Spotify_icon.svg/512px-Spotify_icon.svg.png', dock: false, desktop: true, url: 'https://open.spotify.com' },
            { id: 'discord', name: 'Discord', icon: 'https://assets-global.website-files.com/6257adef93867e50d84d30e2/636e0a6a49cf127bf92de1e2_icon_clyde_blurple_RGB.png', dock: false, desktop: true, url: 'https://discord.com/app' },
            { id: 'telegram', name: 'Telegram', icon: 'https://upload.wikimedia.org/wikipedia/commons/thumb/8/82/Telegram_logo.svg/512px-Telegram_logo.svg.png', dock: false, desktop: true, url: 'https://web.telegram.org' },
            { id: 'youtube', name: 'YouTube', icon: 'https://upload.wikimedia.org/wikipedia/commons/thumb/0/09/YouTube_full-color_icon_%282017%29.svg/512px-YouTube_full-color_icon_%282017%29.svg.png', dock: false, desktop: true, url: 'https://www.youtube.com' },
            { id: 'github', name: 'GitHub', icon: 'https://cdn-icons-png.flaticon.com/512/25/25231.png', dock: false, desktop: true, url: 'https://github.com' },
            { id: 'notion', name: 'Notion', icon: 'https://upload.wikimedia.org/wikipedia/commons/4/45/Notion_app_logo.png', dock: false, desktop: true, url: 'https://www.notion.so' },
            { id: 'terminal', name: 'Terminal', icon: 'https://cdn.jim-nielsen.com/macos/512/terminal-2021-06-03.png?rf=1024', dock: false, desktop: true },
            { id: 'calculator', name: 'Calculator', icon: 'https://cdn.jim-nielsen.com/macos/512/calculator-2021-04-29.png?rf=1024', dock: false, desktop: true },
            { id: 'appstore', name: 'App Store', icon: 'https://upload.wikimedia.org/wikipedia/commons/2/27/App_Store_macOS.png', dock: true, desktop: true },
            //
            { id: 'shop', name: 'Marketplace', icon: 'https://marketplace.canva.com/ZSZ-g/MAG5q1ZSZ-g/1/tl/canva-3d-shopping-cart-MAG5q1ZSZ-g.png', desktop: true, url: 'marketplace.html' },
            { id: 'ntdMusic', name: 'ntdMusic', icon: 'https://www.audkit.com/wp-content/uploads/2023/05/apple-music-converter-icon.png', desktop: true, url: 'TOOLS/songs/index.html' },
            { id: 'chat', name: 'ntdChat', icon: 'https://marketplace.canva.com/q3PYc/MAG8Z0q3PYc/1/tl/canva-blue-chat-speech-bubble-with-three-dots-icon-isolated-on-transparent-background.-MAG8Z0q3PYc.png', desktop: true, url: 'TOOLS/chatv2/index.html' },
            { id: 'HPBD', name: 'HPBD', icon: 'https://cdn-icons-png.freepik.com/512/8611/8611770.png', desktop: true, url: 'TOOLS/happybirthday/index.html' },
            { id: 'search', name: 'Search', icon: 'https://img.icons8.com/fluency/48/search--v1.png', desktop: false, url: 'https://www.bing.com' },
            { id: 'teams', name: 'Microsoft Teams', icon: 'https://img.icons8.com/fluency/48/microsoft-teams-2019.png', desktop: false, url: 'https://teams.microsoft.com' },
            { id: 'outlook', name: 'Outlook', icon: 'https://img.icons8.com/fluency/48/microsoft-outlook-2019.png', desktop: false, url: 'https://outlook.live.com' },
            { id: 'word', name: 'Word', icon: 'https://img.icons8.com/fluency/48/microsoft-word-2019.png', desktop: false, url: 'https://www.office.com/launch/word' },
            { id: 'excel', name: 'Excel', icon: 'https://img.icons8.com/fluency/48/microsoft-excel-2019.png', desktop: false, url: 'https://www.office.com/launch/excel' },
            { id: 'powerpoint', name: 'PowerPoint', icon: 'https://img.icons8.com/fluency/48/microsoft-powerpoint-2019.png', desktop: false, url: 'https://www.office.com/launch/powerpoint' },
            { id: 'onenote', name: 'OneNote', icon: 'https://upload.wikimedia.org/wikipedia/commons/thumb/3/34/Microsoft_OneNote_Icon_%282025_-_present%29.svg/960px-Microsoft_OneNote_Icon_%282025_-_present%29.svg.png', desktop: false, url: 'https://www.onenote.com/notebooks' },
            { id: 'photos', name: 'Photos', icon: 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRIZLpccmw2Dj0mouCEfXK4HfVT10ZjFBQLYg&s', desktop: false, url: 'about:blank' },
            { id: 'settings', name: 'Settings', icon: 'https://img.icons8.com/color/48/settings--v1.png', desktop: false, url: 'about:blank' },
            { id: 'calc', name: 'Calculator', icon: 'https://img.icons8.com/fluency/48/calculator.png', desktop: false, url: 'https://www.desmos.com/scientific?lang=vi' },
            { id: 'notepad', name: 'Notepad', icon: 'https://img.icons8.com/fluency/48/notepad.png', desktop: false, url: 'https://anotepad.com/' },
            { id: 'facebook', name: 'Facebook', icon: 'https://img.icons8.com/color/48/facebook-new.png', desktop: true, url: 'https://www.facebook.com' },
            { id: 'messenger', name: 'Messenger', icon: 'https://upload.wikimedia.org/wikipedia/commons/thumb/b/be/Facebook_Messenger_logo_2020.svg/500px-Facebook_Messenger_logo_2020.svg.png', desktop: true, url: 'https://www.messenger.com' },
            { id: 'instagram', name: 'Instagram', icon: 'https://upload.wikimedia.org/wikipedia/commons/thumb/9/95/Instagram_logo_2022.svg/1280px-Instagram_logo_2022.svg.png', desktop: true, url: 'https://www.instagram.com' },
            { id: 'threads', name: 'Threads', icon: 'https://upload.wikimedia.org/wikipedia/commons/thumb/0/01/Threads_%28app%29.svg/250px-Threads_%28app%29.svg.png', desktop: true, url: 'https://www.threads.net' },
            { id: 'tiktok', name: 'TikTok', icon: 'https://img.icons8.com/color/48/tiktok.png', desktop: true, url: 'https://www.tiktok.com' },
            { id: 'nhaccuatui', name: 'Nhaccuatui', icon: 'https://apkcombo.vn/wp-content/uploads/2023/02/nct-nhaccuatui-nghe-mp3-150x150.png', desktop: true, url: 'https://www.nhaccuatui.com' },
            { id: 'zingmp3', name: 'Zing MP3', icon: 'https://dangcapdigital.vn/img/app/zingmp3-aszyd.png', desktop: true, url: 'https://zingmp3.vn' },
            { id: 'github', name: 'Github', icon: 'https://make-cxp-documentation.ams3.digitaloceanspaces.com/apps-center-icons/github.png', desktop: true, url: 'https://github.com' },
            { id: 'supabase', name: 'Supabase', icon: 'https://yt3.googleusercontent.com/KVjptxDSWT7rjVfGax2TgTNVAYgplgo1z_fwaV3MFjPpcmNVZC0TIgQV030BPJ0ybCP3_Fz-2w=s900-c-k-c0x00ffffff-no-rj', desktop: true, url: 'https://supabase.com' },
            { id: 'ip17', name: 'Iphone 17', icon: 'https://24hstore.vn/images/products/2025/09/10/large/iphone-17-pro-max-cam-01.png', desktop: true, url: 'indexip.html' },
            { id: 's24ultra', name: 'SSG S24 Ultra', icon: 'https://images.samsung.com/is/image/samsung/p6pim/vn/2401/gallery/vn-galaxy-s24-s928-sm-s928bztqxxv-539307591?$624_624_PNG$', desktop: true, url: 'indexadr.html' },
            { id: 'windows11', name: 'Windows 11', icon: 'https://img.icons8.com/color/48/windows-11.png', desktop: true, url: 'index.html' },
            { id: ' minecraft', name: 'Minecraft', icon: 'https://www.rw-designer.com/icon-image/5547-256x256x8.png', desktop: true, url: 'https://classic.minecraft.net' }
        ];

        // ==================== STATE ====================
        let activeWindows = {};
        let minimizedWindows = new Set(); // Track minimized windows
        let zIndex = 100;
        let selectedApp = null;
        let contextTarget = null;
        let draggedWindow = null;
        let dragOffset = { x: 0, y: 0 };

        // Calculator
        let calcDisplayValue = '0';
        let calcPreviousValue = null;
        let calcCurrentOperator = null;
        let calcWaitingForOperand = false;

        // Notes
        let notes = [
            { id: 1, title: 'Welcome', content: 'Welcome to Notes!' },
            { id: 2, title: 'Ideas', content: 'My ideas...' }
        ];
        let currentNoteId = 1;

        // ==================== BOOT ====================
        window.onload = function () {
            let progress = 0;
            const interval = setInterval(() => {
                progress += Math.random() * 25;
                if (progress > 100) progress = 100;
                document.getElementById('bootProgress').style.width = progress + '%';
                if (progress >= 100) {
                    clearInterval(interval);
                    setTimeout(() => {
                        document.getElementById('bootScreen').classList.add('hide');
                        init();
                    }, 300);
                }
            }, 120);
        };

        // ==================== INIT ====================
        function init() {
            loadApps();
            renderDock();
            renderDesktopIcons();
            renderLaunchpad();
            updateTime();
            updateCalendar();
            setInterval(updateTime, 1000);
            setupEventListeners();

            const savedWallpaper = localStorage.getItem('macosWallpaper');
            if (savedWallpaper) {
                document.querySelector('.desktop').style.backgroundImage = `url('${savedWallpaper}')`;
            }
        }

        function loadApps() {
            const saved = localStorage.getItem('macosApps');
            if (saved) apps = JSON.parse(saved);
        }

        function saveApps() {
            localStorage.setItem('macosApps', JSON.stringify(apps));
        }

        // ==================== RENDER ====================
        function renderDock() {
            const dock = document.getElementById('dock');
            if (!dock) return;
            dock.innerHTML = '';

            // Get pinned apps and running apps that aren't pinned
            const pinnedApps = apps.filter(app => app.dock);
            const runningNotPinned = Object.keys(activeWindows)
                .filter(id => !pinnedApps.find(a => a.id === id))
                .map(id => apps.find(a => a.id === id))
                .filter(Boolean);

            const allDockApps = [...pinnedApps, ...runningNotPinned];

            allDockApps.forEach(app => {
                const item = document.createElement('div');
                item.className = 'dock-item';
                item.dataset.appId = app.id;

                if (activeWindows[app.id]) {
                    item.classList.add('running');
                }

                item.innerHTML = `
                    <img src="${app.icon}" alt="${app.name}" onerror="this.src='https://cdn-icons-png.flaticon.com/512/4698/4698888.png'">
                    <span class="tooltip">${app.name}</span>
                    <span class="dock-indicator"></span>
                `;

                item.onclick = () => handleDockClick(app.id);
                item.oncontextmenu = (e) => {
                    e.preventDefault();
                    selectedApp = app;
                    contextTarget = 'dock';
                    showContextMenu(e.pageX, e.pageY);
                };

                dock.appendChild(item);
            });

            // Separator
            const sep = document.createElement('div');
            sep.className = 'dock-separator';
            dock.appendChild(sep);

            // Trash
            const trash = document.createElement('div');
            trash.className = 'dock-item';
            trash.innerHTML = `
                <img src="https://cdn-icons-png.flaticon.com/512/3156/3156999.png" alt="Trash">
                <span class="tooltip">Trash</span>
                <span class="dock-indicator"></span>
            `;
            dock.appendChild(trash);
        }

        function updateDockIndicators() {
            document.querySelectorAll('.dock-item[data-app-id]').forEach(item => {
                const appId = item.dataset.appId;
                if (activeWindows[appId]) {
                    item.classList.add('running');
                } else {
                    item.classList.remove('running');
                }
            });
        }

        function renderDesktopIcons() {
            const container = document.getElementById('desktopIcons');
            container.innerHTML = '';

            apps.filter(app => app.desktop).forEach(app => {
                const icon = document.createElement('div');
                icon.className = 'desktop-icon';
                icon.dataset.appId = app.id;
                icon.innerHTML = `
                    <img src="${app.icon}" alt="${app.name}" onerror="this.src='https://cdn-icons-png.flaticon.com/512/4698/4698888.png'">
                    <span>${app.name}</span>
                `;
                icon.ondblclick = () => openApp(app.id);
                icon.onclick = () => {
                    document.querySelectorAll('.desktop-icon').forEach(i => i.classList.remove('selected'));
                    icon.classList.add('selected');
                    selectedApp = app;
                };
                icon.oncontextmenu = (e) => {
                    e.preventDefault();
                    selectedApp = app;
                    contextTarget = 'desktop-icon';
                    showContextMenu(e.pageX, e.pageY);
                };
                container.appendChild(icon);
            });
        }

        function renderLaunchpad() {
            const container = document.getElementById('launchpadApps');
            container.innerHTML = '';

            apps.filter(app => app.id !== 'about').forEach(app => {
                const item = document.createElement('div');
                item.className = 'launchpad-app';
                item.innerHTML = `
                    <img src="${app.icon}" alt="${app.name}" onerror="this.src='https://cdn-icons-png.flaticon.com/512/4698/4698888.png'">
                    <span>${app.name}</span>
                `;
                item.onclick = () => {
                    closeLaunchpad();
                    setTimeout(() => openApp(app.id), 100);
                };
                container.appendChild(item);
            });
        }

        // ==================== APP MANAGEMENT ====================
        function handleDockClick(appId) {
            // If app is minimized, restore it
            if (minimizedWindows.has(appId)) {
                restoreWindow(appId);
                return;
            }

            // If window exists and visible, focus it
            if (activeWindows[appId]) {
                focusWindow(appId);
                return;
            }

            // Open new window
            openApp(appId);
        }

        function openApp(appId) {
            const app = apps.find(a => a.id === appId);
            if (!app) return;

            document.getElementById('activeAppName').innerHTML = `<strong>${app.name}</strong>`;

            if (appId === 'launchpad') {
                openLaunchpad();
                return;
            }

            // If minimized, restore
            if (minimizedWindows.has(appId)) {
                restoreWindow(appId);
                return;
            }

            // If already open, focus
            if (activeWindows[appId]) {
                focusWindow(appId);
                return;
            }

            createWindow(app);

            // Update dock
            updateDockIndicators();

            // Bounce animation
            const dockItem = document.querySelector(`.dock-item[data-app-id="${appId}"]`);
            if (dockItem) {
                dockItem.classList.add('bouncing');
                setTimeout(() => dockItem.classList.remove('bouncing'), 1500);
            }
        }

        function createWindow(app) {
            const container = document.getElementById('windowsContainer');
            const size = getWindowSize(app.id);

            const win = document.createElement('div');
            win.className = 'window active';
            win.id = 'window-' + app.id;
            win.dataset.appId = app.id;
            win.style.display = 'block';
            win.style.width = size.width + 'px';
            win.style.height = size.height + 'px';
            win.style.left = (window.innerWidth / 2 - size.width / 2 + Math.random() * 40 - 20) + 'px';
            win.style.top = (window.innerHeight / 2 - size.height / 2 + Math.random() * 40 - 20) + 'px';
            win.style.zIndex = ++zIndex;

            win.innerHTML = `
                <div class="window-header">
                    <div class="window-controls">
                        <button class="window-btn close" data-action="close">√ó</button>
                        <button class="window-btn minimize" data-action="minimize">‚àí</button>
                        <button class="window-btn maximize" data-action="maximize">+</button>
                    </div>
                    <div class="window-title">${app.name}</div>
                </div>
                <div class="window-content">${getWindowContent(app)}</div>
                <div class="resize-handle"></div>
            `;

            // Window control buttons
            win.querySelector('[data-action="close"]').onclick = (e) => {
                e.stopPropagation();
                closeWindow(app.id);
            };
            win.querySelector('[data-action="minimize"]').onclick = (e) => {
                e.stopPropagation();
                minimizeWindow(app.id);
            };
            win.querySelector('[data-action="maximize"]').onclick = (e) => {
                e.stopPropagation();
                maximizeWindow(app.id);
            };

            container.appendChild(win);
            activeWindows[app.id] = win;

            makeWindowDraggable(win);
            makeWindowResizable(win);

            win.onmousedown = () => focusWindow(app.id);

            initAppFunctionality(app.id);
            renderDock();
            updateDockIndicators();
        }

        function closeWindow(appId) {
            const win = activeWindows[appId];
            if (win) {
                win.style.transform = 'scale(0.8)';
                win.style.opacity = '0';
                setTimeout(() => {
                    win.remove();
                    delete activeWindows[appId];
                    minimizedWindows.delete(appId);
                    renderDock();
                    updateDockIndicators();
                }, 200);
            }
        }

        function minimizeWindow(appId) {
            const win = activeWindows[appId];
            if (win) {
                win.classList.add('minimized');
                minimizedWindows.add(appId);
                // Window stays in activeWindows but is marked as minimized
            }
        }

        function restoreWindow(appId) {
            const win = activeWindows[appId];
            if (win) {
                win.classList.remove('minimized');
                minimizedWindows.delete(appId);
                focusWindow(appId);
            }
        }

        function maximizeWindow(appId) {
            const win = activeWindows[appId];
            if (win) {
                if (win.dataset.maximized === 'true') {
                    win.style.width = win.dataset.prevWidth;
                    win.style.height = win.dataset.prevHeight;
                    win.style.left = win.dataset.prevLeft;
                    win.style.top = win.dataset.prevTop;
                    win.dataset.maximized = 'false';
                } else {
                    win.dataset.prevWidth = win.style.width;
                    win.dataset.prevHeight = win.style.height;
                    win.dataset.prevLeft = win.style.left;
                    win.dataset.prevTop = win.style.top;
                    win.style.width = '100%';
                    win.style.height = 'calc(100% - 28px - 70px)';
                    win.style.left = '0';
                    win.style.top = '28px';
                    win.dataset.maximized = 'true';
                }
            }
        }

        function focusWindow(appId) {
            Object.values(activeWindows).forEach(w => w.classList.remove('active'));
            const win = activeWindows[appId];
            if (win) {
                win.classList.add('active');
                win.style.zIndex = ++zIndex;

                const app = apps.find(a => a.id === appId);
                if (app) {
                    document.getElementById('activeAppName').innerHTML = `<strong>${app.name}</strong>`;
                }
            }
        }

        function getWindowSize(appId) {
            const sizes = {
                'finder': { width: 850, height: 500 },
                'settings': { width: 750, height: 480 },
                'safari': { width: 1000, height: 650 },
                'chrome': { width: 1000, height: 650 },
                'terminal': { width: 650, height: 400 },
                'calculator': { width: 240, height: 360 },
                'notes': { width: 700, height: 480 },
                'about': { width: 380, height: 320 }
            };
            return sizes[appId] || { width: 800, height: 500 };
        }

        function getWindowContent(app) {
            switch (app.id) {
                case 'finder':
                    return `<div class="finder-content">
                        <div class="finder-sidebar">
                            <div class="finder-sidebar-title">Favorites</div>
                            <div class="finder-sidebar-item active"><i class="fas fa-clock"></i> Recents</div>
                            <div class="finder-sidebar-item"><i class="fas fa-desktop"></i> Desktop</div>
                            <div class="finder-sidebar-item"><i class="fas fa-download"></i> Downloads</div>
                            <div class="finder-sidebar-item"><i class="fas fa-file-alt"></i> Documents</div>
                        </div>
                        <div class="finder-main">
                            <div class="finder-files">
                                <div class="finder-file"><i class="fas fa-folder" style="color:#54aeff"></i><span>Documents</span></div>
                                <div class="finder-file"><i class="fas fa-folder" style="color:#54aeff"></i><span>Downloads</span></div>
                                <div class="finder-file"><i class="fas fa-folder" style="color:#54aeff"></i><span>Pictures</span></div>
                                <div class="finder-file"><i class="fas fa-file-pdf" style="color:#ff5555"></i><span>Report.pdf</span></div>
                            </div>
                        </div>
                    </div>`;

                case 'settings':
                    return `<div class="settings-content">
                        <div class="settings-sidebar">
                            <div class="settings-item active"><i class="fas fa-wifi" style="background:#007aff"></i> Wi-Fi</div>
                            <div class="settings-item"><i class="fas fa-bluetooth-b" style="background:#007aff"></i> Bluetooth</div>
                            <div class="settings-item"><i class="fas fa-volume-up" style="background:#ff2d55"></i> Sound</div>
                            <div class="settings-item"><i class="fas fa-sun" style="background:#ff9500"></i> Display</div>
                        </div>
                        <div class="settings-main">
                            <h3>Wi-Fi</h3>
                            <div class="setting-option">
                                <div><div class="setting-option-title">Wi-Fi</div><div class="setting-option-desc">Connected</div></div>
                                <div class="toggle active" onclick="this.classList.toggle('active')"></div>
                            </div>
                        </div>
                    </div>`;

                case 'safari':
                case 'chrome':
                    return `<div style="display:flex;flex-direction:column;height:100%">
                        <div class="safari-toolbar">
                            <button><i class="fas fa-chevron-left"></i></button>
                            <button><i class="fas fa-chevron-right"></i></button>
                            <button onclick="loadBrowserUrl()"><i class="fas fa-redo"></i></button>
                            <input type="text" class="safari-url" value="${app.url || 'https://google.com'}" id="browserUrl" onkeypress="if(event.key==='Enter')loadBrowserUrl()">
                        </div>
                        <div class="safari-content"><iframe src="${app.url || 'https://google.com'}" id="browserFrame"></iframe></div>
                    </div>`;

                case 'terminal':
                    return `<div class="terminal-content" id="terminalContent">
                        <div class="terminal-line">Last login: ${new Date().toLocaleString()}</div>
                        <div class="terminal-line">Type 'help' for commands.</div>
                        <div class="terminal-input-line">
                            <span class="terminal-prompt">user@mac ~ %</span>
                            <input type="text" id="terminalInput" autocomplete="off">
                        </div>
                    </div>`;

                case 'calculator':
                    return `<div class="calculator-content">
                        <div class="calc-display" id="calcDisplay">0</div>
                        <div class="calc-buttons">
                            <button class="calc-btn gray" onclick="calcClear()">AC</button>
                            <button class="calc-btn gray" onclick="calcNegate()">¬±</button>
                            <button class="calc-btn gray" onclick="calcPercent()">%</button>
                            <button class="calc-btn orange" id="opDiv" onclick="calcSetOperator('/')">√∑</button>
                            <button class="calc-btn dark" onclick="calcDigit('7')">7</button>
                            <button class="calc-btn dark" onclick="calcDigit('8')">8</button>
                            <button class="calc-btn dark" onclick="calcDigit('9')">9</button>
                            <button class="calc-btn orange" id="opMul" onclick="calcSetOperator('*')">√ó</button>
                            <button class="calc-btn dark" onclick="calcDigit('4')">4</button>
                            <button class="calc-btn dark" onclick="calcDigit('5')">5</button>
                            <button class="calc-btn dark" onclick="calcDigit('6')">6</button>
                            <button class="calc-btn orange" id="opSub" onclick="calcSetOperator('-')">‚àí</button>
                            <button class="calc-btn dark" onclick="calcDigit('1')">1</button>
                            <button class="calc-btn dark" onclick="calcDigit('2')">2</button>
                            <button class="calc-btn dark" onclick="calcDigit('3')">3</button>
                            <button class="calc-btn orange" id="opAdd" onclick="calcSetOperator('+')">+</button>
                            <button class="calc-btn dark zero" onclick="calcDigit('0')">0</button>
                            <button class="calc-btn dark" onclick="calcDecimal()">.</button>
                            <button class="calc-btn orange" onclick="calcEquals()">=</button>
                        </div>
                    </div>`;

                case 'notes':
                    return `<div class="notes-content">
                        <div class="notes-sidebar" id="notesSidebar"></div>
                        <div class="notes-editor"><textarea id="noteEditor" placeholder="Start typing..."></textarea></div>
                    </div>`;

                case 'about':
                    return `<div class="about-mac">
                        <img src="https://support.apple.com/library/APPLE/APPLECARE_ALLGEOS/SP803/sp803-imac-702702.png" alt="Mac">
                        <h2>macOS Sonoma</h2>
                        <p>Version 14.0</p>
                        <p style="margin-top:15px"><strong>MacBook Pro</strong></p>
                        <p>Apple M3 Pro</p>
                        <p>Memory: 18 GB</p>
                    </div>`;

                default:
                    if (app.url) {
                        return `<iframe src="${app.url}" style="width:100%;height:100%;border:none"></iframe>`;
                    }
                    return `<div class="app-default">
                        <img src="${app.icon}" onerror="this.style.display='none'">
                        <h3>${app.name}</h3>
                        <p>App is ready</p>
                    </div>`;
            }
        }

        function initAppFunctionality(appId) {
            if (appId === 'terminal') {
                setTimeout(() => {
                    const input = document.getElementById('terminalInput');
                    if (input) {
                        input.addEventListener('keydown', handleTerminalInput);
                        input.focus();
                    }
                }, 100);
            }
            if (appId === 'notes') renderNotes();
            if (appId === 'calculator') calcClear();
        }

        // ==================== BROWSER ====================
        function loadBrowserUrl() {
            const input = document.getElementById('browserUrl');
            const frame = document.getElementById('browserFrame');
            if (input && frame) {
                let url = input.value.trim();
                if (!url.startsWith('http')) url = 'https://' + url;
                frame.src = url;
            }
        }

        // ==================== TERMINAL ====================
        function handleTerminalInput(e) {
            if (e.key === 'Enter') {
                const input = e.target;
                const cmd = input.value.trim();
                const content = document.getElementById('terminalContent');

                const line = document.createElement('div');
                line.className = 'terminal-line';
                line.textContent = `user@mac ~ % ${cmd}`;
                content.insertBefore(line, content.lastElementChild);

                let out = '';
                switch (cmd.split(' ')[0].toLowerCase()) {
                    case 'ls': out = 'Desktop  Documents  Downloads  Pictures'; break;
                    case 'pwd': out = '/Users/user'; break;
                    case 'date': out = new Date().toString(); break;
                    case 'whoami': out = 'user'; break;
                    case 'echo': out = cmd.slice(5); break;
                    case 'help': out = 'Commands: ls, pwd, date, whoami, echo, clear, help'; break;
                    case 'clear':
                        content.innerHTML = `<div class="terminal-input-line"><span class="terminal-prompt">user@mac ~ %</span><input type="text" id="terminalInput" autocomplete="off"></div>`;
                        document.getElementById('terminalInput').addEventListener('keydown', handleTerminalInput);
                        document.getElementById('terminalInput').focus();
                        return;
                    case '': break;
                    default: out = `zsh: command not found: ${cmd.split(' ')[0]}`;
                }

                if (out) {
                    const outLine = document.createElement('div');
                    outLine.className = 'terminal-line';
                    outLine.textContent = out;
                    content.insertBefore(outLine, content.lastElementChild);
                }

                input.value = '';
                content.scrollTop = content.scrollHeight;
            }
        }

        // ==================== NOTES ====================
        function renderNotes() {
            const sidebar = document.getElementById('notesSidebar');
            if (!sidebar) return;
            sidebar.innerHTML = '';
            notes.forEach(note => {
                const item = document.createElement('div');
                item.className = 'notes-list-item' + (note.id === currentNoteId ? ' active' : '');
                item.innerHTML = `<div class="notes-list-title">${note.title}</div><div class="notes-list-preview">${note.content.slice(0, 30)}...</div>`;
                item.onclick = () => {
                    currentNoteId = note.id;
                    document.querySelectorAll('.notes-list-item').forEach(i => i.classList.remove('active'));
                    item.classList.add('active');
                    document.getElementById('noteEditor').value = note.content;
                };
                sidebar.appendChild(item);
            });
            const current = notes.find(n => n.id === currentNoteId);
            if (current) document.getElementById('noteEditor').value = current.content;
        }

        // ==================== CALCULATOR ====================
        function calcDigit(d) {
            if (calcWaitingForOperand) {
                calcDisplayValue = d;
                calcWaitingForOperand = false;
            } else {
                calcDisplayValue = calcDisplayValue === '0' ? d : calcDisplayValue + d;
            }
            updateCalcDisplay();
        }

        function calcClear() {
            calcDisplayValue = '0';
            calcPreviousValue = null;
            calcCurrentOperator = null;
            calcWaitingForOperand = false;
            updateCalcDisplay();
            document.querySelectorAll('.calc-btn.orange').forEach(b => b.classList.remove('active-op'));
        }

        function calcNegate() {
            calcDisplayValue = String(parseFloat(calcDisplayValue) * -1);
            updateCalcDisplay();
        }

        function calcPercent() {
            calcDisplayValue = String(parseFloat(calcDisplayValue) / 100);
            updateCalcDisplay();
        }

        function calcSetOperator(op) {
            document.querySelectorAll('.calc-btn.orange').forEach(b => b.classList.remove('active-op'));
            const val = parseFloat(calcDisplayValue);
            if (calcPreviousValue !== null && calcCurrentOperator && !calcWaitingForOperand) {
                const result = calculate(calcPreviousValue, val, calcCurrentOperator);
                calcDisplayValue = String(result);
                calcPreviousValue = result;
            } else {
                calcPreviousValue = val;
            }
            calcCurrentOperator = op;
            calcWaitingForOperand = true;
            updateCalcDisplay();
            const opMap = { '/': 'opDiv', '*': 'opMul', '-': 'opSub', '+': 'opAdd' };
            document.getElementById(opMap[op])?.classList.add('active-op');
        }

        function calcDecimal() {
            if (calcWaitingForOperand) {
                calcDisplayValue = '0.';
                calcWaitingForOperand = false;
            } else if (!calcDisplayValue.includes('.')) {
                calcDisplayValue += '.';
            }
            updateCalcDisplay();
        }

        function calcEquals() {
            if (!calcPreviousValue || !calcCurrentOperator) return;
            const result = calculate(calcPreviousValue, parseFloat(calcDisplayValue), calcCurrentOperator);
            calcDisplayValue = String(parseFloat(result.toPrecision(9)));
            calcPreviousValue = null;
            calcCurrentOperator = null;
            calcWaitingForOperand = true;
            updateCalcDisplay();
            document.querySelectorAll('.calc-btn.orange').forEach(b => b.classList.remove('active-op'));
        }

        function calculate(a, b, op) {
            switch (op) {
                case '+': return a + b;
                case '-': return a - b;
                case '*': return a * b;
                case '/': return b !== 0 ? a / b : 0;
            }
            return b;
        }

        function updateCalcDisplay() {
            const d = document.getElementById('calcDisplay');
            if (d) {
                d.style.fontSize = calcDisplayValue.length > 7 ? '40px' : calcDisplayValue.length > 5 ? '48px' : '55px';
                d.textContent = calcDisplayValue;
            }
        }

        // ==================== WINDOW DRAG/RESIZE ====================
        function makeWindowDraggable(win) {
            const header = win.querySelector('.window-header');
            header.addEventListener('mousedown', e => {
                if (e.target.closest('.window-controls')) return;
                draggedWindow = win;
                dragOffset = { x: e.clientX - win.offsetLeft, y: e.clientY - win.offsetTop };
            });
        }

        function makeWindowResizable(win) {
            const handle = win.querySelector('.resize-handle');
            handle.addEventListener('mousedown', e => {
                e.preventDefault();
                const startX = e.clientX, startY = e.clientY;
                const startW = win.offsetWidth, startH = win.offsetHeight;
                function resize(e) {
                    win.style.width = Math.max(300, startW + e.clientX - startX) + 'px';
                    win.style.height = Math.max(200, startH + e.clientY - startY) + 'px';
                }
                function stop() {
                    document.removeEventListener('mousemove', resize);
                    document.removeEventListener('mouseup', stop);
                }
                document.addEventListener('mousemove', resize);
                document.addEventListener('mouseup', stop);
            });
        }

        document.addEventListener('mousemove', e => {
            if (draggedWindow) {
                draggedWindow.style.left = (e.clientX - dragOffset.x) + 'px';
                draggedWindow.style.top = Math.max(28, e.clientY - dragOffset.y) + 'px';
            }
        });

        document.addEventListener('mouseup', () => draggedWindow = null);

        // ==================== LAUNCHPAD ====================
        function openLaunchpad() {
            const lp = document.getElementById('launchpad');
            lp.style.display = 'flex';
            setTimeout(() => lp.classList.add('show'), 10);
            document.getElementById('launchpadSearch').value = '';
            document.getElementById('launchpadSearch').focus();
        }

        function closeLaunchpad() {
            const lp = document.getElementById('launchpad');
            lp.classList.remove('show');
            setTimeout(() => lp.style.display = 'none', 300);
        }

        // ==================== CONTEXT MENU ====================
        function showContextMenu(x, y) {
            const menu = document.getElementById('contextMenu');
            menu.style.display = 'block';
            menu.style.left = Math.min(x, innerWidth - 220) + 'px';
            menu.style.top = Math.min(y, innerHeight - 250) + 'px';

            document.getElementById('ctxAddToDock').style.display = selectedApp && !selectedApp.dock ? 'flex' : 'none';
            document.getElementById('ctxRemoveFromDock').style.display = selectedApp?.dock && !selectedApp?.system ? 'flex' : 'none';
            document.getElementById('ctxRemoveApp').style.display = selectedApp && !selectedApp.system ? 'flex' : 'none';
        }

        function hideContextMenu() {
            document.getElementById('contextMenu').style.display = 'none';
        }

        // ==================== TIME ====================
        function updateTime() {
            const now = new Date();
            document.getElementById('currentTime').textContent = now.toLocaleDateString('en-US', {
                weekday: 'short', month: 'short', day: 'numeric', hour: 'numeric', minute: '2-digit'
            });
        }

        function updateCalendar() {
            const now = new Date();
            document.getElementById('calendarDate').textContent = now.getDate();
            document.getElementById('calendarDay').textContent = now.toLocaleDateString('en-US', { weekday: 'long', month: 'long' });
        }

        // ==================== EVENTS ====================
        function setupEventListeners() {
            // Desktop context menu
            document.getElementById('desktop').addEventListener('contextmenu', e => {
                if (e.target.closest('.dock, .window, .desktop-icon')) return;
                e.preventDefault();
                selectedApp = null;
                contextTarget = 'desktop';
                showContextMenu(e.pageX, e.pageY);
            });

            // Click to close menus
            document.addEventListener('click', e => {
                if (!e.target.closest('.context-menu')) hideContextMenu();
                if (!e.target.closest('.apple-menu-dropdown, .apple-logo')) {
                    document.getElementById('appleMenu').classList.remove('show');
                }
                if (!e.target.closest('.notification-center, #notificationBtn')) {
                    document.getElementById('notificationCenter').classList.remove('show');
                }
            });

            // Apple menu
            document.getElementById('appleMenuBtn').onclick = e => {
                e.stopPropagation();
                document.getElementById('appleMenu').classList.toggle('show');
            };

            document.getElementById('aboutMacBtn').onclick = () => {
                document.getElementById('appleMenu').classList.remove('show');
                openApp('about');
            };

            document.getElementById('openSettingsBtn').onclick = () => {
                document.getElementById('appleMenu').classList.remove('show');
                openApp('settings');
            };

            document.getElementById('restartBtn').onclick = () => location.reload();

            // Launchpad
            document.getElementById('launchpad').addEventListener('click', e => {
                if (e.target.id === 'launchpad' || e.target.id === 'launchpadApps') closeLaunchpad();
            });

            document.getElementById('launchpadSearch').addEventListener('input', e => {
                const q = e.target.value.toLowerCase();
                document.querySelectorAll('.launchpad-app').forEach(app => {
                    app.style.display = app.querySelector('span').textContent.toLowerCase().includes(q) ? 'flex' : 'none';
                });
            });

            // Notification center
            document.getElementById('notificationBtn').onclick = e => {
                e.stopPropagation();
                document.getElementById('notificationCenter').classList.toggle('show');
            };

            // Keyboard
            document.addEventListener('keydown', e => {
                if ((e.metaKey || e.ctrlKey) && e.key === ' ') {
                    e.preventDefault();
                    const sp = document.getElementById('spotlight');
                    sp.classList.toggle('show');
                    if (sp.classList.contains('show')) document.getElementById('spotlightInput').focus();
                }
                if (e.key === 'Escape') {
                    document.getElementById('spotlight').classList.remove('show');
                    closeLaunchpad();
                    hideContextMenu();
                    document.querySelectorAll('.modal').forEach(m => m.classList.remove('show'));
                }
            });

            // Spotlight
            document.getElementById('spotlightInput').addEventListener('input', e => {
                const q = e.target.value.toLowerCase();
                const results = document.getElementById('spotlightResults');
                results.innerHTML = '';
                if (q) {
                    apps.filter(a => a.name.toLowerCase().includes(q)).slice(0, 6).forEach(app => {
                        const item = document.createElement('div');
                        item.className = 'spotlight-result';
                        item.innerHTML = `<img src="${app.icon}" onerror="this.src='https://cdn-icons-png.flaticon.com/512/4698/4698888.png'"><div><div class="spotlight-result-name">${app.name}</div><div class="spotlight-result-type">Application</div></div>`;
                        item.onclick = () => {
                            document.getElementById('spotlight').classList.remove('show');
                            document.getElementById('spotlightInput').value = '';
                            results.innerHTML = '';
                            openApp(app.id);
                        };
                        results.appendChild(item);
                    });
                }
            });

            // Context menu actions
            document.getElementById('ctxAddApp').onclick = () => {
                hideContextMenu();
                document.getElementById('addAppModal').classList.add('show');
            };

            document.getElementById('ctxAddToDock').onclick = () => {
                hideContextMenu();
                if (selectedApp) {
                    const app = apps.find(a => a.id === selectedApp.id);
                    if (app) { app.dock = true; saveApps(); renderDock(); }
                }
            };

            document.getElementById('ctxRemoveFromDock').onclick = () => {
                hideContextMenu();
                if (selectedApp && !selectedApp.system) {
                    const app = apps.find(a => a.id === selectedApp.id);
                    if (app) { app.dock = false; saveApps(); renderDock(); }
                }
            };

            document.getElementById('ctxRemoveApp').onclick = () => {
                hideContextMenu();
                if (selectedApp && !selectedApp.system && confirm(`Delete "${selectedApp.name}"?`)) {
                    closeWindow(selectedApp.id);
                    apps = apps.filter(a => a.id !== selectedApp.id);
                    saveApps();
                    renderDock();
                    renderDesktopIcons();
                    renderLaunchpad();
                }
            };

            document.getElementById('ctxChangeWallpaper').onclick = () => {
                hideContextMenu();
                document.getElementById('wallpaperModal').classList.add('show');
            };

            // Add App Modal
            document.getElementById('closeModal').onclick = () => document.getElementById('addAppModal').classList.remove('show');
            document.getElementById('cancelAddApp').onclick = () => document.getElementById('addAppModal').classList.remove('show');
            document.getElementById('confirmAddApp').onclick = () => {
                const name = document.getElementById('appName').value.trim();
                const icon = document.getElementById('appIcon').value.trim();
                const url = document.getElementById('appUrl').value.trim();
                const loc = document.getElementById('appLocation').value;

                if (!name || !icon) return alert('Enter name and icon URL');

                apps.push({
                    id: 'app-' + Date.now(),
                    name, icon,
                    url: url || null,
                    dock: loc === 'dock' || loc === 'both',
                    desktop: loc === 'desktop' || loc === 'both',
                    system: false
                });
                saveApps();
                renderDock();
                renderDesktopIcons();
                renderLaunchpad();
                document.getElementById('appName').value = '';
                document.getElementById('appIcon').value = '';
                document.getElementById('appUrl').value = '';
                document.getElementById('addAppModal').classList.remove('show');
            };

            // Wallpaper Modal
            document.getElementById('closeWallpaperModal').onclick = () => document.getElementById('wallpaperModal').classList.remove('show');
            document.getElementById('cancelWallpaper').onclick = () => document.getElementById('wallpaperModal').classList.remove('show');
            document.getElementById('confirmWallpaper').onclick = () => {
                const url = document.getElementById('wallpaperUrl').value.trim();
                if (url) {
                    document.querySelector('.desktop').style.backgroundImage = `url('${url}')`;
                    localStorage.setItem('macosWallpaper', url);
                }
                document.getElementById('wallpaperModal').classList.remove('show');
            };

            // Deselect icons
            document.getElementById('desktop').addEventListener('click', e => {
                if (!e.target.closest('.desktop-icon')) {
                    document.querySelectorAll('.desktop-icon').forEach(i => i.classList.remove('selected'));
                }
            });
        }

        // Add About app
        apps.unshift({ id: 'about', name: 'About This Mac', icon: 'https://cdn-icons-png.flaticon.com/512/0/747.png', dock: false, desktop: false, system: true });
    </script>
</body>

</html>