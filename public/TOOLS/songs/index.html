<!DOCTYPE html>
<html lang="vi">

<head>
  <meta charset="UTF-8" />
  <title>ntdMusic</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" />
  <link rel="stylesheet" href="css/styles.css">
</head>

<body>
  <header>
    <div>
      <span><i class="fa-solid fa-music"></i></span> <span class="logoweb" onclick="location.reload()">ntdMUSIC</span>
      <span style="font-size: medium; color: rgba(255,255,255,0.5);"><span class="rauMa" onclick="alert('B·∫•m v√¥ ƒë√¢y l√†m c√°i ch√≥ g√¨??? Var h·∫£???')">36</span></span>
    </div>
    <div class="search-container">
      <input type="text" id="searchInput" class="search-input" placeholder="üîé T√¨m theo t√™n, ca sƒ©, s√°ng t√°c ho·∫∑c l·ªùi b√†i h√°t..." />
      <select id="artistFilter" class="artist-filter">
        <option value="">-- T·∫•t c·∫£ ca sƒ© --</option>
        <!-- Options s·∫Ω ƒë∆∞·ª£c t·∫°o ƒë·ªông t·ª´ JS -->
      </select>
    </div>
    <div id="authButtons" style="display: flex; align-items: center; gap: 12px;">
      <button class="btn btn-add" onclick="loginDialog.showModal()" id="btn-login" title="ƒêƒÉng nh·∫≠p">
        <i class="fa-solid fa-user"></i>
      </button>
      <button class="btn btn-add" onclick="toggleSidebar()" id="btn-menu-guest" title="Menu">
        <i class="fa-solid fa-bars"></i>
      </button>
    </div>
    <div id="userInfo" style="display: none; align-items: center; gap: 12px;">
      <span id="userDisplayName" style="font-size: 26px;"></span>
      <button class="btn btn-add" onclick="showViewProfile()" id="btn-info-sc" title="Th√¥ng tin t√†i kho·∫£n">
        <i class="fa-solid fa-user"></i>
      </button>
      <button class="btn btn-add" onclick="handleLogout()" id="btn-logout" title="ƒêƒÉng xu·∫•t">
        <i class="fa-solid fa-right-from-bracket"></i>
      </button>
      <button class="btn btn-add" onclick="toggleSidebar()" id="btn-menu" title="Menu">
        <i class="fa-solid fa-bars"></i>
      </button>
    </div>
  </header>

<!-- Sidebar Menu -->
<div id="sidebar" class="sidebar">
  <div class="sidebar-header">
    <h3>Menu</h3>
    <button class="btn-close-sidebar" onclick="toggleSidebar()">
      <i class="fa-solid fa-xmark"></i>
    </button>
  </div>
  <div class="sidebar-content">
    Song
    <button class="sidebar-item" id="btn-reload-sc" onclick="location.reload(); toggleSidebar();">
      <i class="fa-solid fa-arrow-rotate-right"></i>
      <span>L√†m m·ªõi</span>
    </button>
    <button class="sidebar-item" id="btn-add-sc" onclick="addSongDialog.showModal(); toggleSidebar();">
      <i class="fa-solid fa-plus"></i>
      <span>Th√™m b√†i h√°t</span>
    </button>
    Feature other
    <button class="sidebar-item" id="btn-youtube-sc" onclick="openYoutubeSearchDialog(); toggleSidebar();">
      <i class="fa-brands fa-youtube"></i>
      <span>T√¨m video YouTube</span>
    </button>
    <button class="sidebar-item" id="btn-hoiAI-sc" onclick="hoiAI(); toggleSidebar();">
      <i class="fa-solid fa-robot"></i>
      <span>H·ªèi AI</span>
    </button>
    <button class="sidebar-item" id="btn-home-sc" onclick="window.open('https://2937.vercel.app'); toggleSidebar();">
      <i class="fa-solid fa-house"></i>
      <span>Trang ch·ªß</span>
    </button>
    <button class="sidebar-item" id="btn-settings-sc" onclick="openSettingsDialog(); toggleSidebar();">
      <i class="fa-solid fa-gear"></i>
      <span>C√†i ƒë·∫∑t</span>
    </button>
    <button class="sidebar-item" id="btn-history-sc" onclick="openHistoryDialog(); toggleSidebar();">
      <i class="fa-solid fa-clock-rotate-left"></i>
      <span>L·ªãch s·ª≠ th√™m b√†i</span>
    </button>
    <button class="sidebar-item" id="btn-album-sc" onclick="openAlbumDialog(); toggleSidebar();">
      <i class="fa-solid fa-compact-disc"></i>
      <span>Danh s√°ch Album</span>
    </button>
    Social
    <button class="sidebar-item" id="btn-rank-sc" onclick="openRankingDialog(); toggleSidebar();">
      <i class="fa-solid fa-ranking-star"></i>
      <span>B·∫£ng x·∫øp h·∫°ng</span>
    </button>
    <button class="sidebar-item" id="btn-streak-sc" onclick="checkStreak(); toggleSidebar();">
      <i class="fa-solid fa-fire"></i>
      <span id="streakText">ƒêi·ªÉm danh h√†ng ng√†y</span>
    </button>
    <button class="sidebar-item" id="btn-favourite-sc" onclick="openFavouriteDialog(); toggleSidebar();">
      <i class="fa-solid fa-heart"></i>
      <span>B√†i h√°t y√™u th√≠ch</span>
    </button>
    <button class="sidebar-item" id="btn-users-sc" onclick="openUsersDialog(); toggleSidebar();">
      <i class="fa-solid fa-users"></i>
      <span>Danh s√°ch ng∆∞·ªùi d√πng</span>
    </button>
    About
    <button class="sidebar-item" id="btn-guide-sc" onclick="openGuideDialog(); toggleSidebar();">
      <i class="fa-solid fa-circle-info"></i>
      <span>H∆∞·ªõng d·∫´n s·ª≠ d·ª•ng</span>
    </button>
    <button class="sidebar-item" id="btn-updates-sc" onclick="openUpdatesDialog(); toggleSidebar();">
      <i class="fa-solid fa-bullhorn"></i>
      <span>Th√¥ng tin c·∫≠p nh·∫≠t</span>
    </button>
  </div>
</div>

<!-- Overlay -->
<div id="sidebar-overlay" class="sidebar-overlay" onclick="toggleSidebar()"></div>

<div class="filter-section">
  <div class="tag-filter-container">
    <div class="tag-filter-label">
      <i class="fa-solid fa-filter"></i>
      <span>L·ªçc theo tag:</span>
    </div>
    <div class="tag-filter-options" id="tagFilterOptions">
      <!-- Tags s·∫Ω ƒë∆∞·ª£c t·∫°o ƒë·ªông t·ª´ JS -->
    </div>
    <button class="btn-clear-filter" id="btnClearTagFilter" style="display: none;">
      <i class="fa-solid fa-xmark"></i> X√≥a b·ªô l·ªçc
    </button>
  </div>
</div>

  <main>
    <div class="stats-container">
      <div class="stat-card">
        <div class="stat-icon">üéµ</div>
        <div class="stat-content">
          <div class="stat-label">T·ªïng s·ªë b√†i h√°t</div>
          <div class="stat-value" id="totalSongs">0</div>
        </div>
      </div>
    
      <!-- TH√äM CARD STREAK M·ªöI -->
      <div class="stat-card streak-card" onclick="checkStreak()" style="cursor: pointer;">
        <div class="stat-icon">üî•</div>
        <div class="stat-content">
          <div class="stat-label" id="streakLabel">Ch∆∞a c√≥ streak</div>
          <div class="stat-value" id="streakValue">0 ng√†y</div>
        </div>
      </div>
      
      <div class="stat-card mfy-card" id="mfyCard" onclick="showmfyDetail()" style="cursor: pointer;">
        <div class="stat-icon">‚≠ê</div>
        <div class="stat-content">
          <div class="stat-label">Music for YOU</div>
          <div class="stat-value" id="mfySong">---</div>
          <div class="mfy-lyric" id="mfyLyric"></div>
        </div>
      </div>
    </div>
    <table>
      <thead>
        <tr>
          <th>Avatar</th>
          <th>T√™n b√†i h√°t</th>
          <th>Ca sƒ©</th>
          <th>S√°ng t√°c</th>
          <th>Ng√†y ph√°t h√†nh</th>
          <th>Hot</th>
          <th>Thao t√°c</th>
        </tr>
      </thead>
      <tbody id="list"></tbody>
      <tbody>
        <tr>
          <th> </th>
          <th> </th>
          <th> </th>
          <th> </th>
          <th> </th>
          <th> </th>
          <th> </th>
        </tr>
      </tbody>
      <tbody>
        <tr>
          <th> </th>
          <th> </th>
          <th> </th>
          <th> </th>
          <th> </th>
          <th> </th>
          <th> </th>
        </tr>
      </tbody>
    </table>
  </main>
  <dialog id="lyricDialog">
    <button class="btn close" onclick="lyricDialog.close()">
      <span style="font-size: 30px;" id="closeNew">+</span>
    </button>
    <h2 id="dTitle"></h2>
    <div class="lyric-container">
      <div class="lyric-avatar">
        <img id="dAvatar" src="" alt="avatar" style="display: none" />
        <hr width="100%" color="white" style="border: none; height: 1px; margin: 32px 0; background-color: white; opacity: 1;">
        <div style="font-weight: 700; text-align: center; font-style: italic;">Nghe nh·∫°c</div>
        <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/8/84/Spotify_icon.svg/250px-Spotify_icon.svg.png" class="iconMXH" onclick="spotifyThismusic()" />
        <img src="https://dangcapdigital.vn/img/app/zingmp3-aszyd.png" class="iconMXH" onclick="zingmp3Thismusic()" />
        <img src="https://upload.wikimedia.org/wikipedia/commons/2/2b/NhacCuaTui_2022logo.png" class="iconMXH" onclick="nctThismusic()" />

        <button onclick="alert('Ch√∫ √Ω √¢m l∆∞·ª£ng khi ph√°t nh·∫°c!');openNctMusicDialog()" style="
        width: 90%;
        padding: 12px 24px;
        background: rgb(87, 87, 255);
        border: none;
        border-radius: 12px;
        color: white;
        font-weight: 600;
        cursor: pointer;
        font-size: 16px;
        margin: 12px auto;
        display: block;
        transition: all 0.3s;
      " onmouseover="this.style.transform='translateY(-3px)'; this.style.boxShadow='0 8px 25px rgba(255,0,0,0.4)'" 
         onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none'">
        <i class="fa-solid fa-music"></i> Nghe Nh·∫°c Tr√™n Web
      </button>

        <hr width="100%" color="white" style="border: none; height: 1px; margin: 32px 0; background-color: white; opacity: 1;">
        <div style="font-weight: 700; text-align: center; font-style: italic;">Xem MV / Video</div>
        <img src="https://upload.wikimedia.org/wikipedia/commons/e/ef/Youtube_logo.png" class="iconMXH" onclick="youtubeThismusic()" />
        <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQiXN9xSEe8unzPBEQOeAKXd9Q55efGHGB9BA&s" class="iconMXH" onclick="facebookThismusic()" />
        <img src="https://p16-tiktokcdn-com.akamaized.net/obj/tiktok-obj/32f2ab89bf0d9acee8ff3021890559a7.png" class="iconMXH" onclick="tiktokThismusic()" />

  <button onclick="openYoutubeVideoDialog()" style="
    width: 90%;
    padding: 12px 24px;
    background: linear-gradient(135deg, #ff0000, #cc0000);
    border: none;
    border-radius: 12px;
    color: white;
    font-weight: 600;
    cursor: pointer;
    font-size: 16px;
    margin: 12px auto;
    display: block;
    transition: all 0.3s;
  " onmouseover="this.style.transform='translateY(-3px)'; this.style.boxShadow='0 8px 25px rgba(255,0,0,0.4)'" 
     onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none'">
    <i class="fa-brands fa-youtube"></i> Xem Video Tr√™n Web
  </button>

      </div>
      <div class="lyric-content">
        <div style="display: flex; align-items: center; gap: 16px; margin-bottom: 8px;">
          <p id="dArtist" style="margin: 0; flex: 1;"></p>
          <button 
            id="btnFavouriteLyric" 
            onclick="toggleFavourite()" 
            class="btn-favourite"
            title="Y√™u th√≠ch"
          >
            <i class="fa-solid fa-heart"></i>
          </button>
        </div>
        <p id="dDate"></p>
        <p id="dAlbum"></p>
        <p id="dAddedBy"></p>
        <pre id="dLyric"></pre>
      </div>
      </div>
    </div>
  </dialog>
  <dialog id="addSongDialog">
    <button class="btn close" onclick="addSongDialog.close()">
      <span style="font-size: 30px;" id="closeNew">+</span>
    </button>
    <h2>Th√™m b√†i h√°t m·ªõi</h2>
    <form id="songForm">
      <div class="form-group">
        <a href="https://www.google.com/search?q=b%C3%A0i+h%C3%A1t+hot+nh%E1%BA%A5t+tiktok+hi%E1%BB%87n+t%E1%BA%A1i" target="_blank" class="goiy">G·ª£i √Ω</a>
        <label for="songName">T√™n b√†i h√°t *</label>
        <input type="text" id="songName" placeholder="Nh·∫≠p t√™n b√†i h√°t" required />
        <div class="error" id="error-songName"></div>
      </div>
      <div class="form-group">
        <a href="#" class="goiy" onclick="timCasi()">Kh√¥ng bi·∫øt t√™n ca sƒ©?</a>
        <label for="artist">Ca sƒ© *</label>
        <input type="text" id="artist" placeholder="Nh·∫≠p t√™n ca sƒ©" required />
        <div class="error" id="error-artist"></div>
      </div>
      <div class="form-group">
        <a href="#" class="goiy" onclick="timSangtac()">Kh√¥ng bi·∫øt ai s√°ng t√°c?</a>
        <label for="composer">S√°ng t√°c *</label>
        <input type="text" id="composer" placeholder="Nh·∫≠p t√™n ng∆∞·ªùi s√°ng t√°c" required />
        <div class="error" id="error-composer"></div>
      </div>
      <div class="form-group">
        <label style="display: flex; align-items: center; gap: 10px; cursor: pointer; text-transform: none; font-size: 15px;">
          <input type="checkbox" id="hasAlbum" style="width: auto; cursor: pointer; accent-color: var(--accent-primary);">
          <span>B√†i h√°t n·∫±m trong album</span>
        </label>
      </div>
      <div class="form-group" id="albumGroup" style="display: none;">
        <a href="#" class="goiy" onclick="timAlbum()">T√¨m album</a>
        <label for="album">T√™n Album</label>
        <input type="text" id="album" placeholder="Nh·∫≠p t√™n album" />
        <div class="error" id="error-album"></div>
      </div>
      <div class="form-group">
        <a href="#" class="goiy" onclick="timLinkbaihat()">T√¨m link b√†i h√°t</a>
        <label>Link YouTube (ch·ªâ c·∫ßn khi th·∫•y ng√†y ph√°t h√†nh b·ªã sai)</label>
        <div style="display:flex; gap:8px">
          <input type="url" id="youtubeLinkAdd" placeholder="https://www.youtube.com/watch?v=..." />
          <button type="button" class="btn" onclick="fetchYoutubeDate('add')" style="padding: 0 14px">
            üìÖ
          </button>
        </div>
      </div>

      <div class="form-group">
        <a href="#" class="goiy" onclick="timNgayphathanh()">Kh√¥ng bi·∫øt ng√†y ph√°t h√†nh?</a>
        <label for="releaseDate">Ng√†y ph√°t h√†nh *</label>
        <div style="display:flex; gap:8px">
          <input type="date" id="releaseDate" required />
          <button type="button" class="btn" title="T·ª± t√¨m ng√†y ph√°t h√†nh theo t√™n b√†i h√°t" onclick="autoFindReleaseDate()" style="padding: 0 14px">
            üîç
          </button>
        </div>

        <div class="error" id="error-releaseDate"></div>
      </div>
      <div class="form-group">
        <a href="#" onclick="timAvatar1()" class="goiy">T√¨m avatar</a>
        <label for="avatar">URL Avatar</label>
        <input type="url" id="avatar" placeholder="Nh·∫≠p link/url c·ªßa ·∫£nh" />
        <div class="error" id="error-avatar"></div>
      </div>
      <div class="form-group">
        <a href="#" class="goiy" onclick="timLoibaihat()">T√¨m l·ªùi b√†i h√°t</a>
        <label for="lyric">L·ªùi b√†i h√°t</label>
        <textarea id="lyric" placeholder="Nh·∫≠p l·ªùi b√†i h√°t ƒë√£ sao ch√©p"></textarea>
        <div class="error" id="error-lyric"></div>
      </div>

      <div class="form-group">
        <a href="#" class="goiy" onclick="timTag()">T√¨m th·ªÉ lo·∫°i</a>
        <label>Tags (Ch·ªçn c√°c tag ph√π h·ª£p)</label>
        <div class="tag-selector" id="tagSelector">
          <div class="tag-option" data-tag="Sad">Sad</div>
          <div class="tag-option" data-tag="Happy">Happy</div>
          <div class="tag-option" data-tag="Love">Love</div>
          <div class="tag-option" data-tag="V-pop">V-pop</div>
          <div class="tag-option" data-tag="Rap">Rap</div>
          <div class="tag-option" data-tag="Ballad">Ballad</div>
          <div class="tag-option" data-tag="K-pop">K-pop</div>
          <div class="tag-option" data-tag="Lofi">Lofi</div>
          <div class="tag-option" data-tag="Indie">Indie</div>
          <div class="tag-option" data-tag="Trending">Trending</div>
        </div>

        <input type="hidden" id="selectedTags" value="">
      </div>

      <div class="form-group">
        <label for="addedBy">Ng∆∞·ªùi th√™m</label>
        <input type="text" id="addedBy" readonly style="background: #0f0f12; cursor: not-allowed; opacity: 0.7;" />
        <small style="color: #6b7280; font-size: 14px; margin-top: 4px; display: block;">
          üí° T·ª± ƒë·ªông l·∫•y t·ª´ t√†i kho·∫£n ƒëang ƒëƒÉng nh·∫≠p
        </small>
      </div>

      <div class="form-group">
        <label for="adminCode">M√£ x√°c minh Admin (t√πy ch·ªçn)</label>
        <input type="text" id="adminCode" placeholder="Nh·∫≠p m√£ admin ƒë·ªÉ t·ª± ƒë·ªông x√°c minh" />
        <div class="error" id="error-adminCode"></div>
        <small style="
                            color: #6b7280;
                            font-size: 14px;
                            margin-top: 4px;
                            display: block;
                        ">üí° Nh·∫≠p m√£ admin ƒë·ªÉ b√†i h√°t ƒë∆∞·ª£c x√°c minh ngay l·∫≠p
          t·ª©c</small>
      </div>
      <div class="form-actions">
        <button type="button" class="btn btn-cancel" onclick="addSongDialog.close()">
          H·ªßy
        </button>
        <button type="submit" class="btn btn-submit">
          Th√™m b√†i h√°t
        </button>
      </div>
    </form>
  </dialog>

  <dialog id="editSongDialog">
    <button class="btn close" onclick="editSongDialog.close()">
      <span style="font-size: 30px;" id="closeNew">+</span>
    </button>
    <h2>Ch·ªânh s·ª≠a b√†i h√°t</h2>
    <form id="editSongForm">
      <div class="form-group">
        <label for="editSongName">T√™n b√†i h√°t *</label>
        <input type="text" id="editSongName" required />
        <div class="error" id="error-editSongName"></div>
      </div>
      <div class="form-group">
        <label for="editArtist">Ca sƒ© *</label>
        <input type="text" id="editArtist" required />
        <div class="error" id="error-editArtist"></div>
      </div>
      <div class="form-group">
        <label for="editComposer">S√°ng t√°c *</label>
        <input type="text" id="editComposer" required />
        <div class="error" id="error-editComposer"></div>
      </div>
      <div class="form-group">
        <label style="display: flex; align-items: center; gap: 10px; cursor: pointer; text-transform: none; font-size: 15px;">
          <input type="checkbox" id="editHasAlbum" style="width: auto; cursor: pointer; accent-color: var(--accent-primary);">
          <span>B√†i h√°t n·∫±m trong album</span>
        </label>
      </div>
      <div class="form-group" id="editAlbumGroup" style="display: none;">
        <a href="#" class="goiy" onclick="timAlbum2()">T√¨m album</a>
        <label for="editAlbum">T√™n Album</label>
        <input type="text" id="editAlbum" placeholder="Nh·∫≠p t√™n album" />
        <div class="error" id="error-editAlbum"></div>
      </div>
      <div class="form-group">
        <label for="editReleaseDate">Ng√†y ph√°t h√†nh *</label>
        <input type="date" id="editReleaseDate" required />
        <div class="error" id="error-editReleaseDate"></div>
      </div>
      <div class="form-group">
        <a href="#" onclick="timAvatar()" class="goiy">T√¨m avatar</a>
        <label for="editAvatar">URL Avatar</label>
        <input type="url" id="editAvatar" />
        <div class="error" id="error-editAvatar"></div>
      </div>
      <div class="form-group">
        <label for="editLyric">L·ªùi b√†i h√°t</label>
        <textarea id="editLyric"></textarea>
        <div class="error" id="error-editLyric"></div>
      </div>
      
      <div class="form-group">
        <a href="#" class="goiy" onclick="timTag2()">T√¨m th·ªÉ lo·∫°i</a>
        <label>Tags (Ch·ªçn c√°c tag ph√π h·ª£p)</label>
        <div class="tag-selector" id="editTagSelector">
          <div class="tag-option" data-tag="Sad">Sad</div>
          <div class="tag-option" data-tag="Happy">Happy</div>
          <div class="tag-option" data-tag="Love">Love</div>
          <div class="tag-option" data-tag="V-pop">V-pop</div>
          <div class="tag-option" data-tag="Rap">Rap</div>
          <div class="tag-option" data-tag="Ballad">Ballad</div>
          <div class="tag-option" data-tag="K-pop">K-pop</div>
          <div class="tag-option" data-tag="Lofi">Lofi</div>
          <div class="tag-option" data-tag="Indie">Indie</div>
          <div class="tag-option" data-tag="Trending">Trending</div>
        </div>
        <input type="hidden" id="editSelectedTags" value="">
      </div>

      <div class="form-actions">
        <button type="button" class="btn btn-cancel" onclick="editSongDialog.close()">
          H·ªßy
        </button>
        <button type="submit" class="btn btn-submit">
          C·∫≠p nh·∫≠t b√†i h√°t
        </button>
      </div>
    </form>
  </dialog>

  <dialog id="loginDialog">
    <button class="btn close" onclick="loginDialog.close()">
      <span style="font-size: 30px;" id="closeNew">+</span>
    </button>
    <h2>ƒêƒÉng nh·∫≠p</h2>
    <form id="loginForm">
      <div class="form-group">
        <label for="loginEmail">Email *</label>
        <input type="email" id="loginEmail" required placeholder="example@email.com" />
      </div>
      <div class="form-group">
        <label for="loginPassword">M·∫≠t kh·∫©u *</label>
        <input type="password" id="loginPassword" required />
      </div>
      <div class="form-actions">
        <button type="button" class="btn btn-cancel" onclick="loginDialog.close()">H·ªßy</button>
        <button type="submit" class="btn btn-submit">ƒêƒÉng nh·∫≠p</button>
      </div>
      <div style="text-align: center; margin-top: 16px;">
        <a href="#" class="goiy" onclick="event.preventDefault(); loginDialog.close(); registerDialog.showModal()">
          Ch∆∞a c√≥ t√†i kho·∫£n? ƒêƒÉng k√Ω ngay
        </a>
      </div>
    </form>
  </dialog>

  <dialog id="registerDialog">
    <button class="btn close" onclick="registerDialog.close()">
      <span style="font-size: 30px;" id="closeNew">+</span>
    </button>
    <h2>ƒêƒÉng k√Ω t√†i kho·∫£n</h2>
    <form id="registerForm">
      <div class="form-group">
        <label for="regDisplayName">T√™n hi·ªÉn th·ªã * (3~20 k√≠ t·ª±)</label>
        <input type="text" id="regDisplayName" required placeholder="Nguy·ªÖn VƒÉn A" minlength="3" maxlength="20"/>
        <div class="error" id="error-regDisplayName"></div>
      </div>
      <div class="form-group">
        <label for="regEmail">Email *</label>
        <input type="email" id="regEmail" required placeholder="example@email.com" />
        <div class="error" id="error-regEmail"></div>
      </div>
      <div class="form-group">
        <label for="regPhone">S·ªë ƒëi·ªán tho·∫°i *</label>
        <input type="tel" id="regPhone" required placeholder="0912345678" />
        <div class="error" id="error-regPhone"></div>
      </div>
      <div class="form-group">
        <label for="regPassword">M·∫≠t kh·∫©u *</label>
        <input type="password" id="regPassword" required placeholder="T·ªëi thi·ªÉu 6 k√Ω t·ª±" />
        <div class="error" id="error-regPassword"></div>
      </div>
      <div class="form-group">
        <label for="regConfirmPassword">Nh·∫≠p l·∫°i m·∫≠t kh·∫©u *</label>
        <input type="password" id="regConfirmPassword" required />
        <div class="error" id="error-regConfirmPassword"></div>
      </div>
      <div class="form-actions">
        <button type="button" class="btn btn-cancel" onclick="registerDialog.close()">H·ªßy</button>
        <button type="submit" class="btn btn-submit">ƒêƒÉng k√Ω</button>
      </div>
      <div style="text-align: center; margin-top: 16px;">
        <a href="#" class="goiy" onclick="event.preventDefault(); registerDialog.close(); loginDialog.showModal()">
          ƒê√£ c√≥ t√†i kho·∫£n? ƒêƒÉng nh·∫≠p
        </a>
      </div>
    </form>
  </dialog>

  <dialog id="viewProfileDialog">
    <button class="btn close" onclick="viewProfileDialog.close()">
      <span style="font-size: 30px;" id="closeNew">+</span>
    </button>
    <h2>Th√¥ng tin t√†i kho·∫£n</h2>
    <div style="padding: 20px;">
      <div style="display: flex; padding: 12px; border-bottom: 1px solid #2a2a33;">
        <label style="flex: 0 0 100px; font-weight: 600; opacity: 0.7;">T√™n hi·ªÉn th·ªã:</label>
        <span id="viewDisplayName"></span>
      </div>
      <div style="display: flex; padding: 12px; border-bottom: 1px solid #2a2a33;">
        <label style="flex: 0 0 100px; font-weight: 600; opacity: 0.7;">Email:</label>
        <span id="viewEmail"></span>
      </div>
      <div style="display: flex; padding: 12px; border-bottom: 1px solid #2a2a33;">
        <label style="flex: 0 0 100px; font-weight: 600; opacity: 0.7;">S·ªë ƒëi·ªán tho·∫°i:</label>
        <span id="viewPhone"></span>
      </div>
      <div style="display: flex; padding: 12px; border-bottom: 1px solid #2a2a33;">
        <label style="flex: 0 0 100px; font-weight: 600; opacity: 0.7;">Vai tr√≤:</label>
        <span id="viewRole"></span>
      </div>
      <div style="display: flex; padding: 12px; border-bottom: 1px solid #2a2a33;">
        <label style="flex: 0 0 100px; font-weight: 600; opacity: 0.7;">L·ªùi nh·∫Øn: </label>
        <span>Qr ƒë∆∞·ªõi ƒë√¢y l√† th√¥ng tin li√™n h·ªá! Kh√¥ng ph·∫£i Qr chuy·ªÉn ti·ªÅn hay thanh to√°n n√™n ƒë·ª´ng lo.</span>
      </div>
      <br>
      <img src="https://api.qrserver.com/v1/create-qr-code/?size=300x300&data=https://www.facebook.com/nthdat.7" alt="QR Facebook" style="text-align: center;padding: 20px; background-color: white;" />
      <div style="margin-top: 24px; text-align: center;">
        <button class="btn btn-submit" onclick="openGopyDialog()" style="margin-right: 8px;">
          <i class="fa-solid fa-comment"></i> G√≥p √Ω
        </button>
        <button class="btn btn-edit" onclick="openEditProfileDialog()">
          <i class="fa-solid fa-pen-to-square"></i> Ch·ªânh s·ª≠a th√¥ng tin
        </button>
      </div>
    </div>
  </dialog>

  <dialog id="editProfileDialog">
    <button class="btn close" onclick="editProfileDialog.close()">
      <span style="font-size: 30px;" id="closeNew">+</span>
    </button>
    <h2>Ch·ªânh s·ª≠a th√¥ng tin</h2>
    <form id="editProfileForm">
      <div class="form-group">
        <label for="editDisplayName">T√™n hi·ªÉn th·ªã * (3~20 k√≠ t·ª±)</label>
        <input type="text" id="editDisplayName" required minlength="3" maxlength="20">
        <div class="error" id="error-editDisplayName"></div>
      </div>

      <div class="form-group">
        <label for="editPhone">S·ªë ƒëi·ªán tho·∫°i *</label>
        <input type="tel" id="editPhone" required placeholder="0912345678">
        <div class="error" id="error-editPhone"></div>
      </div>

      <hr style="border: none; height: 1px; background-color: #2a2a33; margin: 24px 0;">
      <h3 style="margin-bottom: 16px;">ƒê·ªïi m·∫≠t kh·∫©u (t√πy ch·ªçn)</h3>
      <small style="color: #6b7280; display: block; margin-bottom: 16px;">
        üí° Ch·ªâ ƒëi·ªÅn n·∫øu b·∫°n mu·ªën ƒë·ªïi m·∫≠t kh·∫©u
      </small>

      <div class="form-group">
        <label for="oldPassword">M·∫≠t kh·∫©u c≈©</label>
        <input type="password" id="oldPassword">
        <div class="error" id="error-oldPassword"></div>
      </div>

      <div class="form-group">
        <label for="newPassword">M·∫≠t kh·∫©u m·ªõi</label>
        <input type="password" id="newPassword" placeholder="T·ªëi thi·ªÉu 6 k√Ω t·ª±">
        <div class="error" id="error-newPassword"></div>
      </div>

      <div class="form-group">
        <label for="confirmNewPassword">X√°c nh·∫≠n m·∫≠t kh·∫©u m·ªõi</label>
        <input type="password" id="confirmNewPassword">
        <div class="error" id="error-confirmNewPassword"></div>
      </div>

      <div class="form-actions">
        <button type="button" class="btn btn-cancel" onclick="editProfileDialog.close()">
          H·ªßy
        </button>
        <button type="submit" class="btn btn-submit">
          L∆∞u thay ƒë·ªïi
        </button>
      </div>
    </form>
  </dialog>

  <dialog id="gopyDialog">
    <button class="btn close" onclick="gopyDialog.close()">
      <span style="font-size: 30px;">+</span>
    </button>
    <h2>G√≥p √Ω / Ph·∫£n h·ªìi</h2>
    <form id="gopyForm">
      <div class="form-group">
        <label for="gopyDisplayName">T√™n c·ªßa b·∫°n</label>
        <input type="text" id="gopyDisplayName" readonly style="background: #0f0f12; cursor: not-allowed; opacity: 0.7;" />
      </div>
      
      <div class="form-group">
        <label for="gopyTieude">Lo·∫°i g√≥p √Ω *</label>
        <select id="gopyTieude" required style="width: 100%; padding: 14px 18px; border: 2px solid var(--border-color); border-radius: 14px; background: rgba(255, 255, 255, 0.03); color: var(--text-primary); font-family: inherit; font-size: 16px;">
          <option value="" disabled selected>-- Ch·ªçn lo·∫°i g√≥p √Ω --</option>
          <option value="error">üêõ Error - B√°o l·ªói</option>
          <option value="lag">‚è±Ô∏è Lag - Hi·ªáu su·∫•t ch·∫≠m</option>
          <option value="more">‚ú® More - Y√™u c·∫ßu th√™m t√≠nh nƒÉng</option>
        </select>
        <div class="error" id="error-gopyTieude"></div>
      </div>

      <div class="form-group">
        <label style="display: flex; align-items: center; gap: 10px; cursor: pointer; text-transform: none; font-size: 15px;">
          <input type="checkbox" id="gopyWantReply" style="width: auto; cursor: pointer; accent-color: var(--accent-primary);">
          <span>ƒêƒÉng k√Ω nh·∫≠n ph·∫£n h·ªìi qua Email</span>
        </label>
      </div>
      
      <div class="form-group" id="gopyEmailGroup" style="display: none;">
        <label for="gopyEmail">Email nh·∫≠n ph·∫£n h·ªìi *</label>
        <input type="email" id="gopyEmail" placeholder="example@email.com" />
        <div class="error" id="error-gopyEmail"></div>
      </div>
      
      <div class="form-group">
        <label for="gopyNoidung">N·ªôi dung *</label>
        <textarea id="gopyNoidung" required placeholder="Nh·∫≠p n·ªôi dung g√≥p √Ω c·ªßa b·∫°n..." style="min-height: 200px;"></textarea>
        <div class="error" id="error-gopyNoidung"></div>
      </div>
      
      <div class="form-actions">
        <button type="button" class="btn btn-cancel" onclick="gopyDialog.close()">
          H·ªßy
        </button>
        <button type="submit" class="btn btn-submit">
          G·ª≠i g√≥p √Ω
        </button>
      </div>
    </form>
  </dialog>

  <dialog id="rankingDialog">
    <button class="btn close" onclick="rankingDialog.close()">
      <span style="font-size:30px">+</span>
    </button>
  
    <h2>üèÜ B·∫£ng x·∫øp h·∫°ng ƒë√≥ng g√≥p</h2>
  
    <div style="padding: 24px">
      <ul id="rankingList"></ul>
      <hr>
      <div id="currentUserRank" style="margin-top:12px;font-weight:600"></div>
    </div>
  </dialog>

  <dialog id="userSongsDialog">
    <button class="btn close" onclick="userSongsDialog.close()">
      <span style="font-size: 30px;">+</span>
    </button>
    <h2 id="userSongsTitle">üéµ B√†i h√°t c·ªßa <span id="userSongsName"></span></h2>
    
    <div style="padding: 24px;">
      <div id="userSongsStats" style="
        padding: 16px 20px;
        background: linear-gradient(135deg, rgba(99, 102, 241, 0.15), rgba(139, 92, 246, 0.1));
        border: 1px solid var(--accent-primary);
        border-radius: 12px;
        margin-bottom: 20px;
        text-align: center;
        font-weight: 600;
      "></div>
      
      <div id="userSongsList" style="
        max-height: 500px;
        overflow-y: auto;
      "></div>
    </div>
  </dialog>

  <dialog id="favouriteDialog">
    <button class="btn close" onclick="favouriteDialog.close()">
      <span style="font-size: 30px;">+</span>
    </button>
    
    <h2>‚ù§Ô∏è B√†i H√°t Y√™u Th√≠ch</h2>
    
    <div style="padding: 24px 32px 32px 32px;">
      <div id="favouriteStats" style="
        padding: 20px 24px;
        background: linear-gradient(135deg, rgba(239, 68, 68, 0.15), rgba(220, 38, 38, 0.1));
        border: 1px solid #ef4444;
        border-radius: 16px;
        margin-bottom: 24px;
        text-align: center;
        font-weight: 600;
      ">
        <div style="font-size: 14px; color: var(--text-secondary); margin-bottom: 8px;">
          T·ªïng s·ªë b√†i y√™u th√≠ch
        </div>
        <div id="favouriteCount" style="font-size: 32px; font-weight: 800; color: #ef4444;">
          0
        </div>
      </div>
      
      <div id="favouriteList" style="max-height: 500px; overflow-y: auto;">
      </div>
    </div>
  </dialog>

  <dialog id="guideDialog">
    <button class="btn close" onclick="guideDialog.close()">
      <span style="font-size: 30px;">+</span>
    </button>
    <h2>üìñ H∆∞·ªõng d·∫´n s·ª≠ d·ª•ng</h2>
    
    <div style="padding: 24px 32px 32px 32px; max-height: 70vh; overflow-y: auto;">
      <div id="guideContent"></div>
    </div>
  </dialog>

  <dialog id="youtubeVideoDialog">
    <button class="btn close" onclick="youtubeVideoDialog.close();">
      <span style="font-size: 30px;">+</span>
    </button>
    <h2><i class="fa-brands fa-youtube"></i> <span id="youtubeVideoSongName"></span></h2>
    
    <div style="padding: 24px 32px 32px 32px;">
      <div id="youtubeVideoIframe"></div>
      
      <!-- Other Version Section -->
      <div style="margin-top: 20px;">
        <strong style="font-size: 16px; color: var(--text-primary);">Other Version:</strong>
        <div style="display: flex; gap: 12px; margin-top: 12px; flex-wrap: wrap;">
          <div id="ytVersionRemix"></div>
          <div id="ytVersionLofi"></div>
        </div>
      </div>
      
      <!-- N√∫t OTHER ƒë·ªÉ hi·ªÉn th·ªã 3 video thay th·∫ø -->
      <div style="margin-top: 24px;">
        <button 
          id="btnShowOtherVideos" 
          onclick="toggleOtherVideos()" 
          style="
            width: 100%;
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            color: white;
            border: none;
            padding: 14px 24px;
            border-radius: 12px;
            font-size: 15px;
            font-weight: 700;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(245, 158, 11, 0.4);
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
          "
          onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 20px rgba(245, 158, 11, 0.6)';"
          onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 15px rgba(245, 158, 11, 0.4)';"
        >
          <i class="fa-solid fa-list"></i> Hi·ªÉn th·ªã c√°c video kh√°c
        </button>
      </div>
      
      <!-- Container ƒë·ªÉ hi·ªÉn th·ªã 3 video thay th·∫ø -->
      <div id="otherVideosContainer" style="display: none; margin-top: 24px;">
        <div style="
          background: rgba(255, 255, 255, 0.05);
          border: 1px solid var(--border-color);
          border-radius: 16px;
          padding: 20px;
        ">
          <h3 style="
            margin: 0 0 16px 0;
            font-size: 16px;
            font-weight: 700;
            color: var(--text-primary);
          ">
            <i class="fa-solid fa-video"></i> C√°c video thay th·∫ø
          </h3>
          <div id="otherVideosList" style="
            display: flex;
            flex-direction: column;
            gap: 12px;
          ">
            <!-- Videos s·∫Ω ƒë∆∞·ª£c th√™m v√†o ƒë√¢y b·∫±ng JavaScript -->
          </div>
        </div>
      </div>
    </div>
  </dialog>

  <dialog id="spotifyDialog">
    <button class="btn close" onclick="spotifyDialog.close();">
      <span style="font-size: 30px;">+</span>
    </button>
    <h2><i class="fa-brands fa-spotify"></i> <span id="spotifySongName"></span></h2>
    
    <div style="padding: 24px 32px 32px 32px;">
      <div id="spotifyIframe"></div>
    </div>
  </dialog>

  <dialog id="nctMusicDialog">
    <button class="btn close" onclick="nctMusicDialog.close();">
      <span style="font-size: 30px;">+</span>
    </button>
    <h2>
      <img src="https://apkcombo.vn/wp-content/uploads/2023/02/nct-nhaccuatui-nghe-mp3.png" 
           style="height: 32px; vertical-align: middle; margin-right: 8px;" 
           alt="NCT">
      <span id="nctMusicSongName"></span>
    </h2>
    
    <div style="padding: 24px 32px 32px 32px;">
      <div id="nctMusicIframe"></div>
      
      <!-- Other Version Section -->
      <div style="margin-top: 20px;">
        <strong style="font-size: 16px; color: var(--text-primary);">Other Version:</strong>
        <div style="display: flex; gap: 12px; margin-top: 12px; flex-wrap: wrap;">
          <div id="nctVersionRemix"></div>
          <div id="nctVersionAcoustic"></div>
        </div>
      </div>
      
      <!-- N√∫t OTHER ƒë·ªÉ hi·ªÉn th·ªã 3 b√†i h√°t thay th·∫ø -->
      <div style="margin-top: 24px;">
        <button 
          id="btnShowOtherNctSongs" 
          onclick="toggleOtherNctSongs()" 
          style="
            width: 100%;
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            color: white;
            border: none;
            padding: 14px 24px;
            border-radius: 12px;
            font-size: 15px;
            font-weight: 700;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(245, 158, 11, 0.4);
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
          "
          onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 20px rgba(245, 158, 11, 0.6)';"
          onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 15px rgba(245, 158, 11, 0.4)';"
        >
          <i class="fa-solid fa-list"></i> Hi·ªÉn th·ªã c√°c b√†i kh√°c
        </button>
      </div>
      
      <!-- Container ƒë·ªÉ hi·ªÉn th·ªã 3 b√†i h√°t thay th·∫ø -->
      <div id="otherNctSongsContainer" style="display: none; margin-top: 24px;">
        <div style="
          background: rgba(255, 255, 255, 0.05);
          border: 1px solid var(--border-color);
          border-radius: 16px;
          padding: 20px;
        ">
          <h3 style="
            margin: 0 0 16px 0;
            font-size: 16px;
            font-weight: 700;
            color: var(--text-primary);
          ">
            <i class="fa-solid fa-music"></i> C√°c b√†i h√°t thay th·∫ø
          </h3>
          <div id="otherNctSongsList" style="
            display: flex;
            flex-direction: column;
            gap: 12px;
          ">
            <!-- Songs s·∫Ω ƒë∆∞·ª£c th√™m v√†o ƒë√¢y b·∫±ng JavaScript -->
          </div>
        </div>
      </div>
    </div>
  </dialog>

  <dialog id="settingsDialog">
    <button class="btn close" onclick="settingsDialog.close()">
      <span style="font-size: 30px;">+</span>
    </button>
    
    <h2><i class="fa-solid fa-gear"></i> C√†i ƒë·∫∑t</h2>
    
    <form id="settingsForm">
      <div style="padding: 24px 32px 32px 32px; max-height: 70vh; overflow-y: auto;">
        
        <!-- THEME SECTION -->
        <div class="settings-section">
          <h3><i class="fa-solid fa-palette"></i> Giao di·ªán</h3>
          <div class="setting-item">
            <div class="setting-label">
              <strong>Theme</strong>
              <small>Ch·ªçn giao di·ªán s√°ng ho·∫∑c t·ªëi</small>
            </div>
            <select id="settingTheme" class="theme-select" style="width: 140px; margin-left: 16px;">
              <option value="dark">üåô T·ªëi</option>
              <option value="light">‚òÄÔ∏è S√°ng</option>
            </select>
          </div>
        </div>
  
        <!-- PERFORMANCE SECTION -->
        <div class="settings-section">
          <h3>
            <i class="fa-solid fa-gauge-high"></i> Hi·ªáu su·∫•t
            <span class="performance-badge">Gi·∫£m lag</span>
          </h3>
          
          <div class="setting-item">
            <div class="setting-label">
              <strong>Hi·ªáu ·ª©ng chuy·ªÉn ƒë·ªông</strong>
              <small>Animations v√† transitions (gi·∫£m lag ~15%)</small>
            </div>
            <label class="toggle-switch">
              <input type="checkbox" id="settingAnimations" checked>
              <span class="toggle-slider"></span>
            </label>
          </div>
          
          <div class="setting-item">
            <div class="setting-label">
              <strong>Hi·ªáu ·ª©ng n·ªÅn gradient</strong>
              <small>4 l·ªõp gradient + SVG noise (gi·∫£m lag ~25%)</small>
            </div>
            <label class="toggle-switch">
              <input type="checkbox" id="settingBackgroundEffects" checked>
              <span class="toggle-slider"></span>
            </label>
          </div>
          
          <div class="setting-item">
            <div class="setting-label">
              <strong>Hi·ªáu ·ª©ng ph√°t s√°ng</strong>
              <small>Glow effects v√† drop-shadows (gi·∫£m lag ~10%)</small>
            </div>
            <label class="toggle-switch">
              <input type="checkbox" id="settingGlowEffects" checked>
              <span class="toggle-slider"></span>
            </label>
          </div>
          
          <div class="setting-item">
            <div class="setting-label">
              <strong>Backdrop Blur</strong>
              <small>L√†m m·ªù n·ªÅn dialog/header (gi·∫£m lag ~30%)</small>
            </div>
            <label class="toggle-switch">
              <input type="checkbox" id="settingBackdropBlur" checked>
              <span class="toggle-slider"></span>
            </label>
          </div>
          
          <div class="setting-item">
            <div class="setting-label">
              <strong>Box Shadows</strong>
              <small>B√≥ng ƒë·ªï c√°c elements (gi·∫£m lag ~15%)</small>
            </div>
            <label class="toggle-switch">
              <input type="checkbox" id="settingBoxShadows" checked>
              <span class="toggle-slider"></span>
            </label>
          </div>
          
          <div class="setting-item">
            <div class="setting-label">
              <strong>Hi·ªáu ·ª©ng hover ·∫£nh</strong>
              <small>Transform/scale ·∫£nh khi hover (gi·∫£m lag ~8%)</small>
            </div>
            <label class="toggle-switch">
              <input type="checkbox" id="settingImageHover" checked>
              <span class="toggle-slider"></span>
            </label>
          </div>
          
          <div class="setting-item">
            <div class="setting-label">
              <strong>Hi·ªáu ·ª©ng hover b·∫£ng</strong>
              <small>Gradient/scale rows khi hover (gi·∫£m lag ~12%)</small>
            </div>
            <label class="toggle-switch">
              <input type="checkbox" id="settingTableHover" checked>
              <span class="toggle-slider"></span>
            </label>
          </div>
          
          <div class="setting-item">
            <div class="setting-label">
              <strong>Animation dialog</strong>
              <small>Pop-up effect khi m·ªü dialog (gi·∫£m lag ~5%)</small>
            </div>
            <label class="toggle-switch">
              <input type="checkbox" id="settingDialogAnimations" checked>
              <span class="toggle-slider"></span>
            </label>
          </div>
        </div>
  
        <!-- INFO SECTION -->
        <div class="settings-section" style="background: rgba(16, 185, 129, 0.05); border-color: rgba(16, 185, 129, 0.3);">
          <h3 style="color: #10b981;"><i class="fa-solid fa-circle-info"></i> G·ª£i √Ω</h3>
          <p style="margin: 0; font-size: 14px; color: var(--text-secondary); line-height: 1.6;">
            üí° <strong>Lag nh·∫π:</strong> T·∫Øt Backdrop Blur + Background Effects<br>
            üöÄ <strong>Lag trung b√¨nh:</strong> T·∫Øt th√™m Box Shadows + Table Hover<br>
            ‚ö° <strong>Lag n·∫∑ng:</strong> T·∫Øt h·∫øt t·∫•t c·∫£ (gi·∫£m lag l√™n ƒë·∫øn 95%)<br>
            üìå C√†i ƒë·∫∑t t·ª± ƒë·ªông l∆∞u v√† √°p d·ª•ng m·ªói khi m·ªü web
          </p>
        </div>
  
      </div>
      
      <div class="settings-actions" style="padding: 20px 32px 32px 32px; border-top: 1px solid var(--border-color);">
        <button type="button" class="btn btn-reset" onclick="resetSettings()">
          <i class="fa-solid fa-rotate-left"></i> ƒê·∫∑t l·∫°i m·∫∑c ƒë·ªãnh
        </button>
        <button type="submit" class="btn btn-submit">
          <i class="fa-solid fa-check"></i> L∆∞u c√†i ƒë·∫∑t
        </button>
      </div>
    </form>
  </dialog>

  <dialog id="historyDialog">
    <button class="btn close" onclick="historyDialog.close()">
      <span style="font-size: 30px;">+</span>
    </button>
    
    <h2><i class="fa-solid fa-clock-rotate-left"></i> L·ªãch s·ª≠ th√™m b√†i h√°t</h2>
    
    <div style="padding: 24px 32px 32px 32px;">
      <!-- Th·ªëng k√™ -->
      <div id="historyStats"></div>
      
      <!-- Danh s√°ch -->
      <div id="historyList"></div>
    </div>
  </dialog>

  <dialog id="albumDialog">
    <button class="btn close" onclick="albumDialog.close()">
      <span style="font-size: 30px;">+</span>
    </button>
    <h2><i class="fa-solid fa-compact-disc"></i> Danh s√°ch Album</h2>
    
    <div style="padding: 24px 32px 32px 32px;">
      <div id="albumStats"></div>
      <div id="albumList"></div>
    </div>
  </dialog>
  
  <!-- Ban User Dialogs -->
  <script>
    fetch('ban.html')
      .then(response => response.text())
      .then(html => {
        const div = document.createElement('div');
        div.innerHTML = html;
        document.body.appendChild(div);
      });
  </script>
  
  <!-- Reject Song Dialogs -->
  <script>
    fetch('reject.html')
      .then(response => response.text())
      .then(html => {
        const div = document.createElement('div');
        div.innerHTML = html;
        document.body.appendChild(div);
      });
  </script>

<!-- ===== THAY TH·∫æ PH·∫¶N CODE T·ª™ D√íNG 960-975 TRONG INDEX.HTML ===== -->
<!-- X√≥a code c≈© t·ª´ d√≤ng 960-975 v√† thay b·∫±ng code n√†y: -->

<script type="module">
  import { supabase } from './js/supabase-client.js';

  // Wrap trong async IIFE ƒë·ªÉ c√≥ th·ªÉ d√πng await
  (async function() {
    try {
      const { data } = await supabase.auth.getUser();
      if (!data || !data.user) {
        console.log('No user logged in');
        return;
      }

      // Ki·ªÉm tra ban status
      const { data: profile, error } = await supabase
        .from('profiles')
        .select('ban, unban_date, reason_ban')
        .eq('id', data.user.id)
        .single();

      if (error) {
        console.error('Error checking ban status:', error);
        return;
      }

      // N·∫øu user b·ªã ban
      if (profile && profile.ban) {
        // Ki·ªÉm tra xem ƒë√£ h·∫øt h·∫°n ch∆∞a
        if (profile.unban_date) {
          const unbanDate = new Date(profile.unban_date);
          const now = new Date();
          
          if (now >= unbanDate) {
            // T·ª± ƒë·ªông unban
            await supabase
              .from('profiles')
              .update({ 
                ban: false, 
                unban_date: null, 
                reason_ban: null 
              })
              .eq('id', data.user.id);
            
            console.log('User auto-unbanned');
            return;
          }
        }
        
        // V·∫´n c√≤n b·ªã ban - hi·ªÉn th·ªã trang ban
        // Import showBanPage t·ª´ ban.js s·∫Ω ƒë∆∞·ª£c load sau
        // ƒê·ª£i DOM load xong
        if (document.readyState === 'loading') {
          document.addEventListener('DOMContentLoaded', () => {
            showBanPageNow(profile.reason_ban, profile.unban_date, data.user.email);
          });
        } else {
          showBanPageNow(profile.reason_ban, profile.unban_date, data.user.email);
        }
      }
    } catch (err) {
      console.error('Error in ban check:', err);
    }
  })();

  // Function ƒë·ªÉ hi·ªÉn th·ªã ban page ngay l·∫≠p t·ª©c
  function showBanPageNow(reason, unbanDate, userEmail) {
    // X√≥a to√†n b·ªô n·ªôi dung
    document.body.innerHTML = '';
    document.body.classList.add('banned');
    
    // Th√™m inline CSS
    const style = document.createElement('style');
    style.textContent = `
      @keyframes fadeIn {
        from { opacity: 0; }
        to { opacity: 1; }
      }
      @keyframes slideUp {
        from {
          transform: translateY(50px);
          opacity: 0;
        }
        to {
          transform: translateY(0);
          opacity: 1;
        }
      }
      @keyframes pulse {
        0%, 100% { transform: scale(1); }
        50% { transform: scale(1.05); }
      }
      body.banned {
        overflow: hidden !important;
        margin: 0;
        padding: 0;
      }
    `;
    document.head.appendChild(style);
    
    // NgƒÉn m·ªçi h√†nh ƒë·ªông
    const preventAll = (e) => {
      e.preventDefault();
      e.stopPropagation();
      e.stopImmediatePropagation();
      return false;
    };
    
    document.addEventListener('keydown', preventAll, true);
    document.addEventListener('click', preventAll, true);
    document.addEventListener('contextmenu', preventAll, true);
    document.addEventListener('mousedown', preventAll, true);
    
    window.onbeforeunload = () => "T√†i kho·∫£n c·ªßa b·∫°n ƒë√£ b·ªã kh√≥a.";
    
    const unbanText = unbanDate 
      ? `B·∫°n s·∫Ω ƒë∆∞·ª£c m·ªü kh√≥a v√†o: <strong>${new Date(unbanDate).toLocaleString('vi-VN')}</strong>` 
      : 'T√†i kho·∫£n c·ªßa b·∫°n b·ªã kh√≥a vƒ©nh vi·ªÖn';
    
    const banPage = document.createElement('div');
    banPage.id = 'banPage';
    banPage.style.cssText = `
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      background: #111127;
      padding: 20px;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      z-index: 999999;
      animation: fadeIn 0.5s ease-in-out;
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
    `;
    
    banPage.innerHTML = `
      <div style="
        background: #1e1e43;
        backdrop-filter: blur(20px);
        border-radius: 24px;
        padding: 48px;
        max-width: 600px;
        text-align: center;
        box-shadow: 0 25px 80px rgba(0, 0, 0, 0.3);
        animation: slideUp 0.6s ease-out;
      ">
        <div style="
          width: 120px;
          height: 120px;
          background: linear-gradient(135deg, #ef4444, #dc2626);
          border-radius: 50%;
          display: flex;
          align-items: center;
          justify-content: center;
          margin: 0 auto 32px;
          box-shadow: 0 10px 40px rgba(239, 68, 68, 0.4);
          animation: pulse 2s infinite;
        ">
          <svg style="width: 64px; height: 64px; color: white;" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M13.477 14.89A6 6 0 015.11 6.524l8.367 8.368zm1.414-1.414L6.524 5.11a6 6 0 018.367 8.367zM18 10a8 8 0 11-16 0 8 8 0 0116 0z" clip-rule="evenodd"/>
          </svg>
        </div>
        
        <h1 style="
          font-size: 32px;
          font-weight: 800;
          color: white;
          margin: 0 0 16px 0;
        ">T√†i kho·∫£n ƒë√£ b·ªã kh√≥a</h1>
        
        <p style="
          font-size: 18px;
          color: #6b7280;
          margin: 0 0 32px 0;
          line-height: 1.6;
        ">${unbanText}</p>
        
        <div style="
          background: #fee2e224;
          border: 2px solid #ef4444;
          border-radius: 16px;
          padding: 24px;
          margin-bottom: 32px;
          text-align: left;
        ">
          <div style="
            font-size: 14px;
            font-weight: 700;
            color: #ff9d9d;
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
          ">L√Ω do:</div>
          <div style="
            font-size: 16px;
            color: white;
            line-height: 1.6;
            word-wrap: break-word;
          ">${reason || 'Kh√¥ng c√≥ l√Ω do c·ª• th·ªÉ'}</div>
        </div>
        
        <div style="
          background: #bdd9ff2e;
          border: 2px solid #3b82f6;
          border-radius: 16px;
          padding: 24px;
          margin-bottom: 32px;
          text-align: left;
        ">
          <div style="
            font-weight: 700;
            color: #a5baff;
            font-size; 25px;
            margin-bottom: 12px;
          ">‚ÑπÔ∏è Th√¥ng tin li√™n h·ªá</div>
          <div style="
            font-size: 15px;
            color: white;
            line-height: 1.8;
          ">
            N·∫øu b·∫°n cho r·∫±ng ƒë√¢y l√† nh·∫ßm l·∫´n ho·∫∑c mu·ªën khi·∫øu n·∫°i, vui l√≤ng li√™n h·ªá:<br>
            <strong style="color: white;">
              üìß nthdat.2937@gmail.com
            </strong>
          </div>
        </div>
        
        <div style="
          font-size: 13px;
          color: #9ca3af;
          margin-top: 24px;
          word-wrap: break-word;
        ">
          Email: <strong>${userEmail || 'N/A'}</strong>
        </div>
        
        <div style="
          margin-top: 24px;
          padding-top: 24px;
          border-top: 1px solid rgba(0,0,0,0.1);
          font-size: 12px;
          color: #9ca3af;
        ">
          üîí B·∫°n kh√¥ng th·ªÉ ƒëƒÉng xu·∫•t hay th·ª±c hi·ªán b·∫•t k·ª≥ thao t√°c n√†o kh√°c tr√™n h·ªá th·ªëng.
        </div>
      </div>
    `;
    
    document.body.appendChild(banPage);
    
    // Disable console
    if (typeof console !== 'undefined') {
      const noop = () => {};
      ['log', 'warn', 'error', 'info', 'debug'].forEach(method => {
        console[method] = noop;
      });
    }
  }
</script>

<!-- ===== CHAT BUTTON & DIALOG ===== -->
<!-- N√∫t chat c√≥ th·ªÉ k√©o th·∫£ -->
<button id="chatButton" class="chat-float-button" title="M·ªü Chat (K√©o ƒë·ªÉ di chuy·ªÉn)">
  <i class="fa-solid fa-comments"></i>
</button>

<!-- Chat Dialog -->
<dialog id="chatDialog" class="dialog-standard dialog-fullscreen">
  <button class="btn-close-dialog" onclick="chatDialog.close()">
    <span>√ó</span>
  </button>
  
  <h2 class="dialog-header dialog-header-chat">
    <i class="fa-solid fa-comments"></i> 
    Chat
  </h2>
  
  <div class="chat-iframe-container">
    <iframe 
      id="chatIframe"
      src="https://chat-zkjh.onrender.com/"
      frameborder="0"
      allow="microphone; camera"
      loading="lazy"
    ></iframe>
  </div>
</dialog>

<style>
/* ===== FLOATING CHAT BUTTON ===== */
.chat-float-button {
  position: fixed;
  bottom: 24px;
  right: 24px;
  width: 60px;
  height: 60px;
  border-radius: 50%;
  background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
  border: none;
  color: white;
  font-size: 24px;
  cursor: move;
  box-shadow: 
    0 8px 30px rgba(99, 102, 241, 0.4),
    0 0 0 1px rgba(255, 255, 255, 0.1);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  z-index: 9999;
  display: flex;
  align-items: center;
  justify-content: center;
  animation: chatButtonPulse 2s infinite;
  user-select: none;
  touch-action: none;
}

.chat-float-button.dragging {
  cursor: grabbing;
  transform: scale(1.1);
  animation: none;
  box-shadow: 
    0 15px 50px rgba(99, 102, 241, 0.6),
    0 0 0 1px rgba(255, 255, 255, 0.2);
}

.chat-float-button:hover {
  transform: scale(1.1) rotate(5deg);
  box-shadow: 
    0 12px 40px rgba(99, 102, 241, 0.6),
    0 0 0 1px rgba(255, 255, 255, 0.2);
}

.chat-float-button:active {
  transform: scale(0.95);
}

/* Pulse animation */
@keyframes chatButtonPulse {
  0%, 100% {
    box-shadow: 
      0 8px 30px rgba(99, 102, 241, 0.4),
      0 0 0 1px rgba(255, 255, 255, 0.1),
      0 0 0 0 rgba(99, 102, 241, 0.4);
  }
  50% {
    box-shadow: 
      0 8px 30px rgba(99, 102, 241, 0.4),
      0 0 0 1px rgba(255, 255, 255, 0.1),
      0 0 0 20px rgba(99, 102, 241, 0);
  }
}

/* ===== CHAT DIALOG ===== */
.dialog-fullscreen {
  width: min(1200px, 95vw);
  height: 85vh;
  max-height: 85vh;
}

.dialog-header-chat {
  background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

.chat-iframe-container {
  width: 100%;
  height: calc(100% - 80px);
  padding: 0;
  overflow: hidden;
  border-radius: 0 0 24px 24px;
}

.chat-iframe-container iframe {
  width: 100%;
  height: 100%;
  border: none;
  display: block;
}

/* Mobile responsive */
@media screen and (max-width: 768px) {
  .chat-float-button {
    width: 56px;
    height: 56px;
    bottom: 20px;
    right: 20px;
    font-size: 22px;
  }
  
  .dialog-fullscreen {
    width: 100vw;
    height: 100vh;
    max-height: 100vh;
    border-radius: 0;
  }
  
  .chat-iframe-container {
    height: calc(100% - 70px);
    border-radius: 0;
  }
}

/* Dark mode adjustments */
[data-theme="light"] .chat-float-button {
  box-shadow: 
    0 8px 30px rgba(99, 102, 241, 0.3),
    0 0 0 1px rgba(0, 0, 0, 0.1);
}

[data-theme="light"] .chat-float-button:hover {
  box-shadow: 
    0 12px 40px rgba(99, 102, 241, 0.5),
    0 0 0 1px rgba(0, 0, 0, 0.15);
}

/* No animations mode */
.no-animations .chat-float-button {
  animation: none;
}

.no-animations .chat-float-button:hover {
  transform: none;
}
</style>

<script>
// Open chat dialog
function openChatDialog() {
  const chatDialog = document.getElementById('chatDialog');
  if (chatDialog) {
    chatDialog.showModal();
  }
}

// Close dialog when clicking outside
chatDialog.addEventListener('click', (e) => {
  if (e.target === chatDialog) {
    chatDialog.close();
  }
});

// ===== DRAGGABLE CHAT BUTTON =====
const chatButton = document.getElementById('chatButton');
let isDragging = false;
let startX, startY;
let hasMoved = false;

// Load saved position from localStorage
function loadButtonPosition() {
  const savedPosition = localStorage.getItem('chatButtonPosition');
  if (savedPosition) {
    const { x, y } = JSON.parse(savedPosition);
    
    // Ki·ªÉm tra xem v·ªã tr√≠ c√≥ h·ª£p l·ªá kh√¥ng
    const windowWidth = window.innerWidth;
    const windowHeight = window.innerHeight;
    const buttonWidth = chatButton.offsetWidth;
    const buttonHeight = chatButton.offsetHeight;
    
    // N·∫øu v·ªã tr√≠ h·ª£p l·ªá th√¨ d√πng
    if (x >= 0 && y >= 0 && x <= windowWidth - buttonWidth && y <= windowHeight - buttonHeight) {
      chatButton.style.left = x + 'px';
      chatButton.style.top = y + 'px';
      chatButton.style.right = 'auto';
      chatButton.style.bottom = 'auto';
    } else {
      // V·ªã tr√≠ kh√¥ng h·ª£p l·ªá, reset v·ªÅ default
      resetToDefaultPosition();
    }
  }
  // N·∫øu ch∆∞a c√≥ v·ªã tr√≠ l∆∞u, gi·ªØ nguy√™n CSS default (bottom-right)
}

// Reset v·ªÅ v·ªã tr√≠ m·∫∑c ƒë·ªãnh (g√≥c d∆∞·ªõi ph·∫£i)
function resetToDefaultPosition() {
  chatButton.style.left = 'auto';
  chatButton.style.top = 'auto';
  chatButton.style.right = '24px';
  chatButton.style.bottom = '24px';
  localStorage.removeItem('chatButtonPosition');
}

// Save position to localStorage
function saveButtonPosition() {
  const rect = chatButton.getBoundingClientRect();
  const position = {
    x: rect.left,
    y: rect.top
  };
  localStorage.setItem('chatButtonPosition', JSON.stringify(position));
}

// Get mouse/touch position
function getEventPosition(e) {
  if (e.type.startsWith('touch')) {
    return {
      x: e.touches[0].clientX,
      y: e.touches[0].clientY
    };
  }
  return {
    x: e.clientX,
    y: e.clientY
  };
}

// Drag start
function dragStart(e) {
  if (e.target === chatButton || e.target.parentElement === chatButton) {
    isDragging = true;
    hasMoved = false;
    
    const pos = getEventPosition(e);
    const rect = chatButton.getBoundingClientRect();
    
    // L∆∞u kho·∫£ng c√°ch t·ª´ con tr·ªè ƒë·∫øn g√≥c tr√™n tr√°i c·ªßa button
    startX = pos.x - rect.left;
    startY = pos.y - rect.top;
    
    chatButton.classList.add('dragging');
    
    // Chuy·ªÉn sang position absolute ƒë·ªÉ d·ªÖ di chuy·ªÉn
    chatButton.style.position = 'fixed';
    chatButton.style.right = 'auto';
    chatButton.style.bottom = 'auto';
    
    e.preventDefault();
  }
}

// Dragging
function drag(e) {
  if (isDragging) {
    e.preventDefault();
    
    const pos = getEventPosition(e);
    
    // T√≠nh to√°n v·ªã tr√≠ m·ªõi (con tr·ªè - offset ban ƒë·∫ßu)
    let newX = pos.x - startX;
    let newY = pos.y - startY;
    
    // L·∫•y k√≠ch th∆∞·ªõc m√†n h√¨nh v√† button
    const windowWidth = window.innerWidth;
    const windowHeight = window.innerHeight;
    const buttonWidth = chatButton.offsetWidth;
    const buttonHeight = chatButton.offsetHeight;
    
    // Gi·ªõi h·∫°n bi√™n (kh√¥ng cho button ra kh·ªèi m√†n h√¨nh)
    newX = Math.max(0, Math.min(windowWidth - buttonWidth, newX));
    newY = Math.max(0, Math.min(windowHeight - buttonHeight, newY));
    
    // Set v·ªã tr√≠ m·ªõi
    chatButton.style.left = newX + 'px';
    chatButton.style.top = newY + 'px';
    
    // ƒê√°nh d·∫•u l√† ƒë√£ di chuy·ªÉn
    hasMoved = true;
  }
}

// Drag end
function dragEnd(e) {
  if (isDragging) {
    isDragging = false;
    chatButton.classList.remove('dragging');
    
    // N·∫øu c√≥ di chuy·ªÉn th√¨ l∆∞u v·ªã tr√≠
    if (hasMoved) {
      saveButtonPosition();
    }
  }
}

// Prevent dialog from opening when dragging
chatButton.addEventListener('click', (e) => {
  if (hasMoved) {
    e.stopPropagation();
    e.preventDefault();
    
    // Reset hasMoved sau khi ngƒÉn ch·∫∑n click
    setTimeout(() => {
      hasMoved = false;
    }, 50);
  } else {
    // Ch·ªâ m·ªü dialog khi KH√îNG c√≥ drag
    openChatDialog();
  }
}, true); // useCapture = true ƒë·ªÉ ch·∫∑n s·ªõm nh·∫•t

// Event listeners for desktop
chatButton.addEventListener('mousedown', dragStart);
document.addEventListener('mousemove', drag);
document.addEventListener('mouseup', dragEnd);

// Event listeners for mobile
chatButton.addEventListener('touchstart', dragStart, { passive: false });
document.addEventListener('touchmove', drag, { passive: false });
document.addEventListener('touchend', dragEnd);

// Load saved position on page load
window.addEventListener('DOMContentLoaded', loadButtonPosition);

// Keyboard shortcut: Shift + C for chat
document.addEventListener('keydown', (e) => {
  if (e.shiftKey && e.key === 'C' && !e.ctrlKey && !e.altKey) {
    const activeElement = document.activeElement;
    const isInputFocused = activeElement.tagName === 'INPUT' || 
                          activeElement.tagName === 'TEXTAREA' ||
                          activeElement.isContentEditable;
    
    if (!isInputFocused) {
      e.preventDefault();
      openChatDialog();
    }
  }
});
</script>
  
  <script src="js/main.js"></script>
  <script src="js/guide.js"></script>
  <script src="js/settings.js"></script>
  <script type="module" src="js/supabase-client.js"></script>
  <script type="module" src="js/favourite.js"></script>
  <script type="module" src="js/rejection.js"></script>
  <script type="module" src="js/ban.js"></script>
  <script type="module" src="js/module.js"></script>
  <script type="module" src="js/update.js"></script>

</body>

</html>